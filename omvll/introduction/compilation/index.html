<!doctype html><html class=dark-mode lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=manifest href=manifest.webmanifest><link rel=icon type=image/svg+xml href=/favicon/favicon.svg><link rel=icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_32x32_fill_box_center_3.png><link rel="shortcut icon" type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><link rel=apple-touch-icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><meta name=description content="How to compile O-MVLL and its dependencies"><meta property="og:type" content="website"><meta property="og:description" content="How to compile O-MVLL and its dependencies"><meta property="og:title" content="Compilation | Open Obfuscator: A free and open-source solution for obfuscating mobile applications."><meta property="og:site_name" content="Open Obfuscator: A free and open-source solution for obfuscating mobile applications."><meta property="og:url" content="https://obfuscator.re/omvll/introduction/compilation/"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2022-09-07T06:41:10+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@open_obfuscator"><meta name=twitter:creator content="@rh0main"><meta name=twitter:title content="Compilation | Open Obfuscator: A free and open-source solution for obfuscating mobile applications."><meta name=twitter:description content="How to compile O-MVLL and its dependencies"><meta name=twitter:domain content="https://obfuscator.re/omvll/introduction/compilation/"><title>Compilation | O-MVLL Documentation</title><link rel=canonical href=https://obfuscator.re/omvll/introduction/compilation/><link rel=stylesheet href=/css/fa-all.min.css><link rel=stylesheet href=/vendor/swiper/swiper-bundle.min.css><link rel=stylesheet href=/vendor/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/css/theme.min.css></head><body><main class=page-wrapper><header class="header navbar navbar-expand bg-light border-bottom border-light shadow fixed-top" data-scroll-header><div class="container-fluid pe-lg-4"><div class="d-flex align-items-center px-4"><a href=https://obfuscator.re/omvll/introduction/ class="navbar-brand flex-shrink-0 py-1 py-lg-2">O-MVLL</a></div><div class="d-flex align-items-center w-100"><ul class="navbar-nav d-none d-lg-flex" style=padding-left:11.75rem><li class=nav-item><a href=https://github.com/open-obfuscator/o-mvll target=_blank class=nav-link><i class="fa-brands fa-github opacity-70 fs-lg me-1"></i>
&nbsp;Source Code</a></li><li class=nav-item><a href=https://github.com/open-obfuscator/o-mvll/releases/ target=_blank class=nav-link><i class="fa-solid fa-download opacity-70 fs-lg me-1"></i>
&nbsp;Download</a></li></ul><button type=button class="navbar-toggler d-block d-lg-none ms-auto me-4" data-bs-toggle=offcanvas data-bs-target=#docsNav aria-controls=docsNav aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="form-check form-switch mode-switch pe-lg-1 ms-lg-auto" data-bs-toggle=obfuscator><input type=checkbox class="form-check-input mt-1" id=which-obfuscator checked>
<label class="form-check-label d-none d-sm-block d-lg-none d-xl-block text-gradient-dprotect" for=theme-mode><strong>dProtect</strong></label>
<label class="form-check-label d-none d-sm-block d-lg-none d-xl-block text-gradient-omvll" for=theme-mode><strong>O-MVLL</strong></label></div><a href=https://obfuscator.re/ class="btn btn-primary btn-sm fs-sm rounded ms-4 d-none d-lg-inline-flex"><i class="fa-sharp fa-solid fa-house-heart fs-5 lh-1 me-1"></i>
&nbsp;Home</a></div></div></header><aside class=dark-mode><div id=docsNav class="offcanvas-lg offcanvas-start d-flex flex-column position-fixed top-0 start-0 vh-100 bg-dark border-end-lg" style=width:21rem;z-index:1045><div class="offcanvas-header d-none d-lg-flex justify-content-start"><a href=/omvll/ class="navbar-brand text-dark d-none d-lg-flex py-0"><svg xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="26.456686" height="26.974693" viewBox="0 0 6.9999978 7.1370545" id="svg20282" sodipodi:docname="omvll.svg"><sodipodi:namedview id="namedview20284" pagecolor="#ffffff" bordercolor="#000000" borderopacity=".25" showgrid="false"/><defs id="defs20279"/><g id="layer1" transform="translate(-2.7177092,-2.2523059)"><g id="g34542" transform="matrix(0.01393956,0,0,0.01393956,2.6491795,2.252306)" style="font-size:80px;font-family:brolink demo;-inkscape-font-specification:'Brolink DEMO, Normal';display:inline;opacity:.778276;stroke-width:37.9613;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:4.79781,9.59564"><g id="g34508" style="stroke-width:37.9613"><path d="m162.144 193.719s67.743-16.576 50.853-114.74c0 0 81.408-135.816 257.901-50.836.0.0-114.839 23.251-86.081 138.61.0.0-77.272-16.404-96.43 49.396.0.0-39.238-26.305-76.384 13.254.001.0-31.497 4.809-49.859-35.684z" fill="#5bc992" id="path34504" style="fill:#0d3758;fill-opacity:1;stroke-width:258.859"/><path d="m168.14 196.604c-3.557.0-6.756-2.472-7.539-6.09-.898-4.15 1.723-8.243 5.861-9.168 1.823-.428 42.24-10.743 40.627-79.558-.229-9.782-1.411-20.039-3.511-30.485l-2.197-10.93c-.84-4.18 1.868-8.251 6.048-9.092 4.184-.838 8.251 1.868 9.092 6.048l2.197 10.93c2.277 11.327 3.559 22.486 3.81 33.167.547 23.372-3.317 55.876-24.841 77.998-13.361 13.732-27.318 16.877-27.906 17.004-.55.118-1.1.176-1.641.176z" fill="#0bb494" id="path34506" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><g id="g34514" style="stroke-width:37.9613"><path d="m230.826 252.7c40.616-35.987 77.278-6.195 77.278-6.195 25.11-63.766 100.553-40.346 100.553-40.346-18.06-117.51 98.427-130.134 98.427-130.134-167.958-100.804-261.476 26.976-261.476 26.976 7.818 99.299-61.159 109.594-61.159 109.594s10.647 24.683 46.377 40.105z" fill="#6fd7a3" id="path34510" style="fill:#135587;fill-opacity:1;stroke-width:258.859"/><path d="m190.86 216.05c-3.848.0-7.177-2.872-7.655-6.788-.514-4.215 2.472-8.051 6.676-8.593 1.85-.258 43.048-6.821 47.752-75.499.668-9.759.432-20.08-.702-30.678l-1.186-11.085c-.453-4.24 2.616-8.046 6.856-8.499 4.242-.449 8.046 2.616 8.499 6.856l1.186 11.085c1.23 11.492 1.483 22.721.753 33.377-1.598 23.324-8.426 55.337-31.888 75.392-14.564 12.449-28.751 14.301-29.348 14.374-.316.039-.631.058-.943.058z" fill="#0bb494" id="path34512" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><path d="m99.22 32.25c54.02-16.304 94.124 31.976 82.031 97.634-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 7.207 128.69-146.88 153.812-189.774 79.616-38.092-65.889 25.07-126.332 25.07-126.332l15.768 13.085s-54.212 57.459-6.717 98.644c41.377 35.88 119.62 4.994 94.473-63.798-22.727-62.169-113.186-48.785-155.96-107.49C70.063 228.345 104.751 176.066 120.847 144.993c26.901-51.934 11.207-94.471-22.844-80.767z" fill="#c9f6b0" id="path34516" style="fill:#1b71af;fill-opacity:1;stroke-width:258.859"/><g id="g34520" style="stroke-width:37.9613"><path d="M328.066 390.702C323.797 314.463 265.762 273.176 230.826 252.7c-36.02-21.111-61.517-57.973-49.575-122.816C193.344 64.227 153.24 15.946 99.22 32.25l-.016.427c31.181 11.593 49.582 49.885 40.867 97.207-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 3.97 70.889-41.004 110.348-89.374 119.094 59.897 11.218 135.657-27.974 130.554-119.094z" fill="#bbf49b" id="path34518" style="fill:#155d91;fill-opacity:1;stroke-width:258.859"/></g><path d="M86.13 29.061 146.528.0s-10.295 53.02-52.157 74.817L75.834 69.492z" fill="#6fd7a3" id="path34522" style="fill:#0cf;fill-opacity:1;stroke-width:258.859"/><path d="m108.988.0-14.942 49.333.325 25.484c.132 10.356-5.648 19.894-14.922 24.625l-53.66 27.374C13.17 133.254-.159 119.45 6.856 107.202c8.309-14.507 17.855-31.646 27.245-49.53C41.851 42.911 53.79 30.729 68.409 22.59z" fill="#c9f6b0" id="path34524" style="fill:#2a95e1;fill-opacity:1;stroke-width:258.859"/><path d="m181.814 315.601c4.614-3.907 11.558.252 10.29 6.164l-6.293 29.354-7.207 33.619c-1.15 5.364-8.11 6.832-11.328 2.389L157.07 373.035c-1.033-1.427-2.614-2.359-4.362-2.573l-16.799-2.056c-5.486-.672-7.543-7.554-3.325-11.126l26.177-22.163z" fill="#6fd7a3" id="path34526" style="fill:#2ad4ff;fill-opacity:.992157;stroke-width:258.859"/><path d="m408.662 213.882c-2.855.0-5.599-1.59-6.939-4.325-.083-.168-8.514-17.05-27.948-36.153-17.846-17.542-48.949-40.642-95.775-51.077-4.162-.927-6.784-5.054-5.857-9.216.927-4.162 5.05-6.787 9.216-5.857 50.722 11.302 84.422 36.5 103.761 55.648 21.095 20.887 30.105 39.107 30.478 39.872 1.869 3.833.277 8.455-3.556 10.324-1.091.533-2.244.784-3.38.784z" fill="#0bb494" id="path34528" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><path d="m308.106 254.226c-.035.0-.068.0-.103-.001-4.254-.056-7.66-3.541-7.62-7.792.0-.459-.233-27.156-22.522-73.746-1.84-3.847-.214-8.457 3.633-10.298s8.457-.214 10.298 3.633c24.143 50.465 24.049 79.377 24.033 80.583-.056 4.231-3.502 7.621-7.719 7.621z" fill="#0bb494" id="path34530" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><g fill="#6fd7a3" id="g34540" style="display:inline;stroke-width:258.859"><path d="m293.41 353.127c-2.935.0-5.74-1.682-7.034-4.528-1.765-3.882-.048-8.459 3.834-10.224 6.955-3.161 18.792-10.715 18.911-10.791 3.592-2.297 8.368-1.248 10.665 2.345s1.248 8.367-2.345 10.665c-.522.334-12.881 8.222-20.84 11.839-1.036.47-2.122.694-3.191.694z" id="path34532" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m308.098 407.232c-4.104.0-7.52-3.231-7.707-7.372-.193-4.26 3.104-7.87 7.364-8.063l20.207-.915c4.259-.189 7.87 3.104 8.063 7.364s-3.104 7.87-7.364 8.063l-20.207.915c-.119.005-.238.008-.356.008z" id="path34534" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m310.641 470.991c-1.381.0-2.779-.37-4.042-1.148l-14.183-8.736c-3.631-2.236-4.762-6.993-2.525-10.623 2.236-3.632 6.993-4.762 10.623-2.525l14.184 8.736c3.631 2.236 4.762 6.993 2.525 10.623-1.459 2.368-3.99 3.673-6.582 3.673z" id="path34536" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m258.788 512c-2.901.0-5.679-1.642-6.994-4.441l-7.245-15.427c-1.813-3.86-.153-8.458 3.707-10.271 3.858-1.813 8.458-.153 10.271 3.707l7.245 15.427c1.813 3.86.153 8.458-3.707 10.271-1.06.498-2.177.734-3.277.734z" id="path34538" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/></g></g></g></svg></a><span class="badge bg-omvll d-none d-lg-inline-block"><strong>O-MVLL</strong></span></div><div class="offcanvas-header d-block d-lg-none border-bottom"><div class="d-flex align-items-center justify-content-between mb-3"><h5 class="d-lg-none mb-0">Menu</h5><button type=button class="btn-close d-lg-none" data-bs-dismiss=offcanvas data-bs-target=#docsNav></button></div><div class="list-group list-group-flush mx-n4"><a href=https://github.com/open-obfuscator/o-mvll target=_blank class="list-group-item list-group-item-action d-flex align-items-center border-0 py-2 px-4"><i class="fa-brands fa-github fs-lg opacity-80 me-2"></i>
Source Code</a>
<a href=https://github.com/open-obfuscator/o-mvll/releases/ target=_blank class="list-group-item list-group-item-action d-flex align-items-center border-0 py-2 px-4"><i class="fa-solid fa-download fs-lg opacity-80 me-2"></i>
Download</a></div></div><div class="offcanvas-body p-4"><div class=swiper-wrapper><div class="swiper-slide h-auto"><h3 class=fs-lg><a href=https://obfuscator.re/omvll/introduction/>Introduction</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/introduction/getting-started/ class="list-group-item list-group-item-action border-0 py-2 px-4">Getting started</a>
<a href=https://obfuscator.re/omvll/introduction/compilation/ class="list-group-item list-group-item-action border-0 py-2 px-4 active">Compilation</a>
<a href=https://open-obfuscator.github.io/o-mvll target=_blank class="list-group-item list-group-item-action border-0 py-2 px-4">API</a></div><h3 class=fs-lg><a href=https://obfuscator.re/omvll/passes/>Obfuscation Passes</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/passes/anti-hook/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-tachograph-digital me-2"></span>
Anti-Hooking</a>
<a href=https://obfuscator.re/omvll/passes/arithmetic/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-calculator-simple me-2"></span>
Arithmetic Obfuscation</a>
<a href=https://obfuscator.re/omvll/passes/control-flow-breaking/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-chart-tree-map me-2"></span>
Control-Flow Breaking</a>
<a href=https://obfuscator.re/omvll/passes/control-flow-flattening/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-cubes-stacked me-2"></span>
Control-Flow Flattening</a>
<a href=https://obfuscator.re/omvll/passes/objcleaner/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-brands fa-apple me-2"></span>
Objective-C Cleaner</a>
<a href=https://obfuscator.re/omvll/passes/opaque-constants/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-input-numeric me-2"></span>
Opaque Constants</a>
<a href=https://obfuscator.re/omvll/passes/opaque-fields-access/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-arrow-right me-2"></span>
Opaque Fields Access</a>
<a href=https://obfuscator.re/omvll/passes/strings-encoding/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-square-a-lock me-2"></span>
Strings Encoding</a></div><h3 class=fs-lg><a href=https://obfuscator.re/omvll/other-topics/>Other Topics</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/other-topics/troubleshooting/ class="list-group-item list-group-item-action border-0 py-2 px-4">Troubleshooting</a>
<a href=https://obfuscator.re/omvll/other-topics/jit/ class="list-group-item list-group-item-action border-0 py-2 px-4">LLVM JIT</a>
<a href=https://obfuscator.re/omvll/other-topics/annotations/ class="list-group-item list-group-item-action border-0 py-2 px-4">Obfuscation Annotations</a></div></div></div><div class="swiper-scrollbar end-0"></div></div><div class="offcanvas-header border-top"><a href=https://obfuscator.re/ class="btn btn-primary w-100" target=_blank rel=noopener><i class="fa-sharp fa-solid fa-house-heart fs-4 lh-1 me-1"></i>
&nbsp;Home</a></div></div></aside><main class="docs-container pt-5 pb-3 pb-lg-4"><div class="container-fluid px-xxl-5 px-lg-4 pt-4 pt-lg-5 pb-4"><section class="container ms-0"><div class=row><div class="col-xl-7 col-lg-8 col-md-7 hugo-generated omvll"><h1 id=compilation>Compilation</h1><p>O-MVLL relies on the following dependencies:</p><ol><li>LLVM (version depending on the toolchain&rsquo;s version)</li><li>CPython (3.10.7)</li><li>spdlog (1.10.0)</li><li>Pybind11 (2.10.0)</li></ol><p>As a first step, let&rsquo;s consider that we compiled all the dependencies.
O-MVLL is a C++17 <strong>out-of-tree</strong> LLVM pass so we don&rsquo;t need to compile LLVM for each build.</p><p>The CMake configuration step can be invoked as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/open-obfuscator/o-mvll.git
</span></span><span style=display:flex><span>$ mkdir o-mvll/src/build <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#8be9fd;font-style:italic>cd</span> o-mvll/src/build
</span></span></code></pre></div><h5 id=on-linux>On Linux</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>$ cmake -GNinja ..                                              <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex;background-color:#3d3f4a><span><span style=color:#f1fa8c></span>        -DCMAKE_CXX_FLAGS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-stdlib=libc++&#34;</span>                      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_ROOT_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>                       <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_LIBRARY<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>/lib/libpython3.10.a    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_INCLUDE_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>/include/python3.10 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -Dpybind11_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYBIND11_ROOT</span><span style=color:#f1fa8c>}</span>/share/cmake/pybind11    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -Dspdlog_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SPDLOG_ROOT</span><span style=color:#f1fa8c>}</span>/lib/cmake/spdlog            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DLLVM_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#f1fa8c>}</span>/lib64/cmake/llvm                <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DClang_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#f1fa8c>}</span>/lib64/cmake/clang
</span></span><span style=display:flex><span>$ ninja
</span></span></code></pre></div><h5 id=on-osx>On OSX</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># On OSX:</span>
</span></span><span style=display:flex><span>$ cmake -GNinja ..                                              <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex;background-color:#3d3f4a><span><span style=color:#f1fa8c></span>        -DCMAKE_OSX_DEPLOYMENT_TARGET<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;11.0&#34;</span>                    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_ROOT_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>                       <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_LIBRARY<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>/lib/libpython3.10.a    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DPython3_INCLUDE_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYTHON_ROOT</span><span style=color:#f1fa8c>}</span>/include/python3.10 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -Dpybind11_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PYBIND11_ROOT</span><span style=color:#f1fa8c>}</span>/share/cmake/pybind11    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -Dspdlog_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SPDLOG_ROOT</span><span style=color:#f1fa8c>}</span>/lib/cmake/spdlog            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DLLVM_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#f1fa8c>}</span>/lib/cmake/llvm                  <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>        -DClang_DIR<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#f1fa8c>}</span>/lib/cmake/clang
</span></span><span style=display:flex><span>$ ninja
</span></span></code></pre></div><p>As it is highlighted, on Linux O-MVLL requires to be compiled with LLVM&rsquo;s <code>libc++</code> and not the
default GNU <code>stdlibc++</code>.
The reason for this requirement is detailed in <a href=https://obfuscator.re/omvll/introduction/getting-started/#android-ndk>Getting Started</a>.</p><p>Since the dependencies of O-MVLL are fixed for a given version of the NDK/Xcode, you can download the
pre-compiled binaries:</p><h3 id=ndk>NDK</h3><div class="alert d-flex alert-info" role=alert style=max-width:1024px><div>All the dependencies are compiled from the Docker image: <a href=https://hub.docker.com/r/openobfuscator/omvll-ndk><code>openobfuscator/omvll-ndk</code></a></div></div><table><thead><tr><th>Version</th><th>URL</th></tr></thead><tbody><tr><td><code>r25</code></td><td><a href=https://data.romainthomas.fr/omvll-deps-ndk-r25.tar>https://data.romainthomas.fr/omvll-deps-ndk-r25.tar</a></td></tr></tbody></table><h3 id=xcode>Xcode</h3><div class="alert d-flex alert-info" role=alert style=max-width:1024px><div>All the dependencies are compiled with both architectures: <code>arm64</code> & <code>x86-64</code> from an Apple M1</div></div><table><thead><tr><th>Version</th><th>URL</th></tr></thead><tbody><tr><td><code>14.0.0</code></td><td><a href=https://data.romainthomas.fr/omvll-deps-xcode-14.tar>https://data.romainthomas.fr/omvll-deps-xcode-14.tar</a></td></tr></tbody></table><div class="card card-body dark-mode border-0 shadow-sm position-relative overflow-hidden ps-sm-5 mb-5 mt-5"><div class="position-absolute top-0 start-0 w-3 h-100 bg-success"></div><div class="d-flex align-items-start border-bottom pb-3"><i class="fa-light fa-rabbit-running fs-xl text-success"></i><div class="ps-2 ms-1"><h6 class="opacity-80 mb-1">Compilation Time</h6></div></div><div class=pt-3><div class="d-flex align-items-start pb-3"><div>Since O-MVLL is an out-of-tree plugin, <strong>it takes about 2 minutes</strong> to fully compile the obfuscator (using
the pre-compiled dependencies).</div></div></div></div><h2 id=cpython><i class="fa-brands fa-python me-1"></i> CPython</h2><p>O-MVLL is currently based on <strong>Python 3.10.7</strong> and we can compile
this dependency as follows:</p><h6 id=linux>Linux</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://www.python.org/ftp/python/3.10.7/Python-3.10.7.tgz
</span></span><span style=display:flex><span>tar xzvf Python-3.10.7.tgz <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#8be9fd;font-style:italic>cd</span> Python-3.10.7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CC</span><span style=color:#ff79c6>=</span>clang
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CXX</span><span style=color:#ff79c6>=</span>clang++
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-fPIC -m64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure                 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --disable-ipv6            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --host<span style=color:#ff79c6>=</span>x86_64-linux-gnu   <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --target<span style=color:#ff79c6>=</span>x86_64-linux-gnu <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --build<span style=color:#ff79c6>=</span>x86_64-linux-gnu  <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --prefix<span style=color:#ff79c6>=</span>./install        <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --disable-test-modules
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make -j<span style=color:#ff79c6>$(</span>nproc<span style=color:#ff79c6>)</span> install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd</span> ./install <span style=color:#ff79c6>&amp;&amp;</span> tar czvf Python.tar.gz *
</span></span></code></pre></div><h6 id=osx>OSX</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://www.python.org/ftp/python/3.10.7/Python-3.10.7.tgz
</span></span><span style=display:flex><span>tar xzvf Python-3.10.7.tgz <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#8be9fd;font-style:italic>cd</span> Python-3.10.7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>MACOSX_DEPLOYMENT_TARGET</span><span style=color:#ff79c6>=</span>11.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure                         <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --disable-ipv6                    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --disable-test-modules            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --prefix<span style=color:#ff79c6>=</span>./install                <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --enable-universalsdk             <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --with-universal-archs<span style=color:#ff79c6>=</span>universal2 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  <span style=color:#8be9fd;font-style:italic>ac_default_prefix</span><span style=color:#ff79c6>=</span>./install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make -j8 install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd</span> ./install <span style=color:#ff79c6>&amp;&amp;</span> tar czvf Python.tar.gz *
</span></span></code></pre></div><h2 id=spdlog><i class="fa-light fa-input-text me-1"></i> spdlog</h2><p><a href=https://github.com/gabime/spdlog>spdlog</a> is used in O-MVLL for logging messages. It can be compiled
for Linux and OSX as follows:</p><h6 id=linux-1>Linux</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://github.com/gabime/spdlog/archive/refs/tags/v1.10.0.tar.gz
</span></span><span style=display:flex><span>tar xzvf v1.10.0.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CXXFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-stdlib=libc++ -fPIC -fno-rtti -fno-exceptions \
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                 -fvisibility-inlines-hidden&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmake -GNinja -S spdlog-1.10.0 -B /tmp/spdlog_build <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_CXX_COMPILER<span style=color:#ff79c6>=</span>clang++-11               <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_BUILD_TYPE<span style=color:#ff79c6>=</span>Release                    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_CXX_FLAGS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CXXFLAGS</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>               <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_THREAD_ID<span style=color:#ff79c6>=</span>on                      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_TLS<span style=color:#ff79c6>=</span>on                            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_EXCEPTIONS<span style=color:#ff79c6>=</span>on                     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_BUILD_EXAMPLE<span style=color:#ff79c6>=</span>off
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ninja -C /tmp/spdlog_build package
</span></span><span style=display:flex><span><span style=color:#6272a4># The compiled package is located here:</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># /tmp/spdlog_build/spdlog-X.Y.Z-Linux.tar.gz</span>
</span></span></code></pre></div><h6 id=osx-1>OSX</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://github.com/gabime/spdlog/archive/refs/tags/v1.10.0.tar.gz
</span></span><span style=display:flex><span>tar xzvf v1.10.0.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CXXFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-fPIC -fno-rtti -fno-exceptions \
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                 -fvisibility-inlines-hidden&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmake -GNinja -S spdlog-1.10.0 -B /tmp/spdlog_build <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_OSX_ARCHITECTURES<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;arm64;x86_64&#34;</span>      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_OSX_DEPLOYMENT_TARGET<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;11.0&#34;</span>          <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_CXX_FLAGS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CXXFLAGS</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>               <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_BUILD_TYPE<span style=color:#ff79c6>=</span>Release                    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_THREAD_ID<span style=color:#ff79c6>=</span>on                      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_TLS<span style=color:#ff79c6>=</span>on                            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_NO_EXCEPTIONS<span style=color:#ff79c6>=</span>on                     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DSPDLOG_BUILD_EXAMPLE<span style=color:#ff79c6>=</span>off
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ninja -C /tmp/spdlog_build package
</span></span><span style=display:flex><span><span style=color:#6272a4># The compiled package is located here:</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># /tmp/spdlog_build/spdlog-1.10.0-Darwin.tar.gz</span>
</span></span></code></pre></div><p>Now, let&rsquo;s have a look at the compilation of LLVM.</p><h2 id=llvm-android-ndk><i class="fa-brands fa-android me-1"></i> LLVM: Android NDK</h2><p>To compile O-MVLL for a given version of the Android NDK toolchain, we first need to identify the version of LLVM
used by the given toolchain.</p><p>Let&rsquo;s consider that <code>$ANDROID_HOME</code> is pointing to the Android SDK root directory that contains the <code>ndk/</code>
sub-directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls <span style=color:#8be9fd;font-style:italic>$ANDROID_HOME</span>/ndk
</span></span><span style=display:flex><span>├── 24.0.8215888
</span></span><span style=display:flex><span>├── 25.0.8775105
</span></span><span style=display:flex><span>└── 25.1.8937393
</span></span></code></pre></div><p>If we aim at compiling O-MVLL for version <code>25.1.8937393</code> of the NDK, we can access the commit of the
LLVM&rsquo;s fork used by Google by looking at the file <code>manifest_&lt;number>.xml</code>.</p><p>This file is located in the toolchain directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat toolchains/llvm/prebuilt/linux-x86_64/manifest_8490178.xml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#6272a4>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;project</span> <span style=color:#50fa7b>path=</span><span style=color:#f1fa8c>&#34;toolchain/llvm-project&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;toolchain/llvm-project&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#50fa7b>revision=</span><span style=color:#f1fa8c>&#34;4c603efb0cca074e9238af8b4106c30add4418f6&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>&lt;!-- ... --&gt;</span>
</span></span></code></pre></div><p>Based on this entry, we can clone the LLVM&rsquo;s fork with the specific commit as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone -j8 https://android.googlesource.com/toolchain/llvm-project
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd</span> llvm-project
</span></span><span style=display:flex><span>git checkout 4c603efb0cca074e9238af8b4106c30add4418f6
</span></span></code></pre></div><p>Once the LLVM&rsquo;s fork repository is ready, we can start the (long) build process. By wrapping the process into
a bash script, we can first declare the build parameters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># O-MVLL only targets AArch64 but we need X86 for the JIT engine</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;AArch64;X86&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Path to the LLVM repository previously cloned</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LLVM_SRC</span><span style=color:#ff79c6>=</span>&lt;ROOT&gt;/llvm-project
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Where to build LLVM: /!\ IT REQUIRES ABOUT 30Go with RelWithDebInfo /!\</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$HOME</span>/dev/o-mvll/build
</span></span></code></pre></div><p>Then we can define the CMake configuration step:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;LLVM Android Version: </span><span style=color:#ff79c6>$(</span>git --git-dir<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_SRC</span><span style=color:#f1fa8c>}</span>/.git describe --dirty<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmake -GNinja
</span></span><span style=display:flex><span>      -S <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_SRC</span><span style=color:#f1fa8c>}</span>/llvm                                     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -B <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span>                                        <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_BUILD_TYPE<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Release&#34;</span>                            <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_CXX_FLAGS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-stdlib=libc++&#34;</span>                      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_LTO<span style=color:#ff79c6>=</span>OFF                                   <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_TERMINFO<span style=color:#ff79c6>=</span>OFF                              <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_THREADS<span style=color:#ff79c6>=</span>ON                                <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_USE_NEWPM<span style=color:#ff79c6>=</span>ON                                     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_VERSION_PATCH<span style=color:#ff79c6>=</span><span style=color:#bd93f9>6</span>                                  <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_LIBDIR_SUFFIX<span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span>                                 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_TARGET_ARCH<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#f1fa8c>}</span>                       <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_TARGETS_TO_BUILD<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#f1fa8c>}</span>                  <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_PROJECTS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;clang;llvm&#34;</span>
</span></span></code></pre></div><p>The purpose of the LLVM options is documented here: <a href=https://llvm.org/docs/CMake.html#options-and-variables>llvm.org/docs/CMake</a>
but some of them are worth more detail.</p><h3 id=llvm_version_patch>LLVM_VERSION_PATCH</h3><p>If we run the <code>clang</code> binary from the Android NDK to get its version, we likely observe this kind of output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./toolchains/llvm/prebuilt/linux-x86_64/bin/clang --version
</span></span><span style=display:flex><span>Android <span style=color:#ff79c6>[</span>...<span style=color:#ff79c6>]</span> clang version 14.0.6
</span></span></code></pre></div><p>We might think that the fork is based on LLVM <code>14.0.6</code> but actually Google set their <strong>own patch version</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>...</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>_patch_level       <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;6&#39;</span>
</span></span><span style=display:flex><span>_svn_revision      <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;r450784d&#39;</span>
</span></span><span style=display:flex><span>_svn_revision_next <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;r450784&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>
</span></span></code></pre></div><p><em>From <a href=https://android.googlesource.com/toolchain/llvm_android/+/5e4bbfa7bbdf0e5013fda78f18d1ee1345627fbc/android_version.py#22>https://android.googlesource.com/toolchain/llvm_android/android_version.py</a></em></p><h3 id=llvm_enable_projects>LLVM_ENABLE_PROJECTS</h3><p>As it is discussed in <a href=https://obfuscator.re/omvll/passes/strings-encoding/>Strings Encoding</a> and
<a href=https://obfuscator.re/omvll/other-topics/jit/>LLVM JIT</a>, O-MVLL uses <code>libClang</code> and <code>ORCv2</code> to JIT C/C++ source code
for the needs of obfuscation passes.
Hence, we also need to compile clang and its libraries along with the main llvm libraries.</p><h3 id=llvm_libdir_suffix>LLVM_LIBDIR_SUFFIX</h3><p>The NDK toolchain uses the <code>lib64/</code> default directory for the resolution of the native libraries.
Therefore, we should match this behavior by setting: <code>-DLLVM_LIBDIR_SUFFIX=64</code></p><hr><p>Once the CMake configuration step done, we can launch the compilation and enjoy a coffee ☕ (or several):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ninja -C <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span> package
</span></span><span style=display:flex><span>-&gt; It should produce: <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span>/LLVM-14.0.6git-Linux.tar.gz
</span></span></code></pre></div><h2 id=llvm-xcode-toolchain><i class="fa-brands fa-apple me-1"></i> LLVM: Xcode Toolchain</h2><p>Similarly, we first need to identify the version of LLVM associated with a given version of the Xcode toolchain.</p><p>As a rule of thumb, we can identify the Swift version associated with the Xcode version from this website:
<a href=https://xcodereleases.com/>https://xcodereleases.com/</a> and then, clone the associated branch from the <a href=https://github.com/apple/llvm-project>Apple&rsquo;s Github repository</a>.</p><p>For instance, Xcode 14.0 is associated with <code>Swift 5.7</code> so we can use the branch <a href=https://github.com/apple/llvm-project/tree/swift/release/5.7><code>swift/release/5.7</code></a>
to compile LLVM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone -j8 --branch swift/release/5.7 --single-branch --depth <span style=color:#bd93f9>1</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>          https://github.com/apple/llvm-project.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;LLVM Apple Version: </span><span style=color:#ff79c6>$(</span>git --git-dir<span style=color:#ff79c6>=</span>llvm-project/.git describe --dirty<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;AArch64;X86&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#ff79c6>=</span>&lt;path to cloned&gt;/llvm-project
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#ff79c6>=</span>/tmp/build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmake -GNinja                                  <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -S <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_ROOT</span><span style=color:#f1fa8c>}</span>/llvm                     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -B <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span>                         <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_BUILD_TYPE<span style=color:#ff79c6>=</span>Release               <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_OSX_ARCHITECTURES<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;arm64;x86_64&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DCMAKE_OSX_DEPLOYMENT_TARGET<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;11.0&#34;</span>     <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_LTO<span style=color:#ff79c6>=</span>OFF                    <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_TERMINFO<span style=color:#ff79c6>=</span>OFF               <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_THREADS<span style=color:#ff79c6>=</span>ON                 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_USE_NEWPM<span style=color:#ff79c6>=</span>ON                      <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_TARGET_ARCH<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#f1fa8c>}</span>        <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_TARGETS_TO_BUILD<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LLVM_TARGET</span><span style=color:#f1fa8c>}</span>   <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      -DLLVM_ENABLE_PROJECTS<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;clang;llvm&#34;</span>
</span></span><span style=display:flex><span>ninja -C <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span> package
</span></span><span style=display:flex><span>-&gt; It should produce: <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>BUILD_ROOT</span><span style=color:#f1fa8c>}</span>/LLVM-14.0.0git-Darwin.tar.gz
</span></span></code></pre></div><h2 id=docker-build><i class="fa-brands fa-docker me-1"></i> Docker Build</h2><p>To ease the compilation of O-MVLL, we provide Docker images with the correct environment to
compile O-MVLL for both Android NDK and the Xcode toolchain.</p><h3 id=android-ndk>Android NDK</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker pull openobfuscator/omvll-ndk
</span></span><span style=display:flex><span>$ git clone https://github.com/open-obfuscator/o-mvll.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ curl -LO https://data.romainthomas.fr/omvll-deps-ndk-r25.tar
</span></span><span style=display:flex><span>$ mkdir -p ./third-party
</span></span><span style=display:flex><span>$ tar xvf omvll-deps-ndk-r25.tar -C ./third-party
</span></span><span style=display:flex><span>$ docker run --rm                           <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         -v <span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/o-mvll:/o-mvll           <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         -v <span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/third-party:/third-party <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         openobfuscator/omvll-ndk sh /o-mvll/scripts/docker/ndk_r25_compile.sh
</span></span></code></pre></div><h3 id=xcode-1>Xcode</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker pull openobfuscator/omvll-xcode
</span></span><span style=display:flex><span>$ git clone https://github.com/open-obfuscator/o-mvll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ curl -LO https://data.romainthomas.fr/omvll-deps-xcode-14.tar
</span></span><span style=display:flex><span>$ mkdir -p ./third-party
</span></span><span style=display:flex><span>$ tar xvf omvll-deps-xcode-&lt;version&gt;.tar -C ./third-party
</span></span><span style=display:flex><span>$ docker run --rm                           <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         -v <span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/o-mvll:/o-mvll           <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         -v <span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/third-party:/third-party <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>         openobfuscator/omvll-xcode sh /o-mvll/scripts/docker/xcode_14_compile.sh
</span></span></code></pre></div></div></div><nav class=pb-5><ul class="pagination d-flex justify-content-left"><li class=page-item><a href=https://obfuscator.re/omvll/introduction/getting-started/ class=page-link><i class="fa-regular fa-chevrons-left ms-n1 me-1 fs-xs"></i>
Getting started</a></li><li class=page-item><a href=https://obfuscator.re/omvll/passes/ class=page-link>Obfuscation Passes
<i class="fa-regular fa-chevrons-right me-n1 ms-1 fs-xs"></i></a></li></ul></nav></main><aside id=jumpToNav class="side-nav side-nav-end d-none d-xxl-block position-fixed top-0 end-0 vh-100 py-5" style=width:20rem><h3 class="fs-lg mt-5 pt-5">Jump to</h3><ul class=nav><li class=nav-item><a class=nav-link href=#cpython data-scroll data-scroll-offset=-6>CPython</a></li><li class=nav-item><a class=nav-link href=#spdlog data-scroll data-scroll-offset=-6>spdlog</a></li><li class=nav-item><a class=nav-link href=#llvm-android-ndk data-scroll data-scroll-offset=-6>LLVM: Android NDK</a></li><li class=nav-item><a class=nav-link href=#llvm-xcode-toolchain data-scroll data-scroll-offset=-6>LLVM: Xcode Toolchain</a></li><li class=nav-item><a class=nav-link href=#docker-build data-scroll data-scroll-offset=-6>Docker Build</a></li></ul></aside></main><footer class="footer dark-mode bg-dark pt-5 pb-4 pb-lg-5"><div class="container text-center pt-lg-3"><p class="nav d-block fs-sm text-center pt-5 mt-lg-4 mb-0"><span class="text-light opacity-50">Site generated with</span>
<a class="nav-link d-inline-block p-0" href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>
<span class="text-light opacity-50">and created by</span>
<a class="nav-link d-inline-block p-0" href=https://www.romainthomas.fr/ target=_blank rel=noopener>R. Thomas</a></p></div></footer><noscript><div class="navbar navbar-expand-lg navbar-dark shadow-sm fixed-bottom d-flex justify-content-center align-items-center"><div class="alert alert-warning fade show" role=alert><i class="fa-solid fa-gingerbread-man me-2"></i>
This website is free from cookies, trackers, and ads but you might want to enable javascript for a
better UI experience.</div></div></noscript><script src=/vendor/bootstrap/dist/js/bootstrap.bundle.min.js></script>
<script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script>
<script src=/vendor/parallax-js/dist/parallax.min.js></script>
<script src=/vendor/jarallax/dist/jarallax.min.js></script>
<script src=/vendor/rellax/rellax.min.js></script>
<script src=/vendor/swiper/swiper-bundle.min.js></script>
<script src=/vendor/lightgallery/lightgallery.min.js></script>
<script src=/vendor/lightgallery/plugins/video/lg-video.min.js></script>
<script>jarallax(document.querySelectorAll(".jarallax"),{speed:.2})</script><script src=/js/theme.min.js></script>
<script src=/js/anime.min.js></script></body></html>