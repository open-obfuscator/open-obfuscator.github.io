<!doctype html><html class=dark-mode lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=manifest href=manifest.webmanifest><link rel=icon type=image/svg+xml href=/favicon/favicon.svg><link rel=icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_32x32_fill_box_center_3.png><link rel="shortcut icon" type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><link rel=apple-touch-icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><meta name=description content="How to get started with O-MVLL"><meta property="og:type" content="website"><meta property="og:description" content="How to get started with O-MVLL"><meta property="og:title" content="Getting started | Open Obfuscator"><meta property="og:site_name" content="Open Obfuscator: A free and open-source solution for obfuscating mobile applications."><meta property="og:url" content="https://obfuscator.re/omvll/introduction/getting-started/"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2024-01-18T11:09:04+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@open_obfuscator"><meta name=twitter:creator content="@rh0main"><meta name=twitter:title content="Getting started | Open Obfuscator"><meta name=twitter:description content="How to get started with O-MVLL"><meta name=twitter:domain content="https://obfuscator.re/omvll/introduction/getting-started/"><title>Getting started | O-MVLL Documentation</title>
<link rel=canonical href=https://obfuscator.re/omvll/introduction/getting-started/><link rel=stylesheet href=/css/fa-all.min.css><link rel=stylesheet href=/vendor/swiper/swiper-bundle.min.css><link rel=stylesheet href=/vendor/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/css/theme.min.css></head><body><main class=page-wrapper><header class="header navbar navbar-expand bg-light border-bottom border-light shadow fixed-top" data-scroll-header><div class="container-fluid pe-lg-4"><div class="d-flex align-items-center px-4"><a href=https://obfuscator.re/omvll/introduction/ class="navbar-brand flex-shrink-0 py-1 py-lg-2">O-MVLL</a></div><div class="d-flex align-items-center w-100"><ul class="navbar-nav d-none d-lg-flex" style=padding-left:11.75rem><li class=nav-item><a href=https://github.com/open-obfuscator/o-mvll target=_blank class=nav-link><i class="fa-brands fa-github opacity-70 fs-lg me-1"></i>
&nbsp;Source Code</a></li><li class=nav-item><a href=https://github.com/open-obfuscator/o-mvll/releases/ target=_blank class=nav-link><i class="fa-solid fa-download opacity-70 fs-lg me-1"></i>
&nbsp;Download</a></li></ul><button type=button class="navbar-toggler d-block d-lg-none ms-auto me-4" data-bs-toggle=offcanvas data-bs-target=#docsNav aria-controls=docsNav aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="form-check form-switch mode-switch pe-lg-1 ms-lg-auto" data-bs-toggle=obfuscator><input type=checkbox class="form-check-input mt-1" id=which-obfuscator checked>
<label class="form-check-label d-none d-sm-block d-lg-none d-xl-block text-gradient-dprotect" for=theme-mode><strong>dProtect</strong></label>
<label class="form-check-label d-none d-sm-block d-lg-none d-xl-block text-gradient-omvll" for=theme-mode><strong>O-MVLL</strong></label></div><a href=https://obfuscator.re/ class="btn btn-primary btn-sm fs-sm rounded ms-4 d-none d-lg-inline-flex"><i class="fa-sharp fa-solid fa-house-heart fs-5 lh-1 me-1"></i>
&nbsp;Home</a></div></div></header><aside class=dark-mode><div id=docsNav class="offcanvas-lg offcanvas-start d-flex flex-column position-fixed top-0 start-0 vh-100 bg-dark border-end-lg" style=width:21rem;z-index:1045><div class="offcanvas-header d-none d-lg-flex justify-content-start"><a href=/omvll/ class="navbar-brand text-dark d-none d-lg-flex py-0"><svg xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="26.456686" height="26.974693" viewBox="0 0 6.9999978 7.1370545" id="svg20282" sodipodi:docname="omvll.svg"><sodipodi:namedview id="namedview20284" pagecolor="#ffffff" bordercolor="#000000" borderopacity=".25" showgrid="false"/><defs id="defs20279"/><g id="layer1" transform="translate(-2.7177092,-2.2523059)"><g id="g34542" transform="matrix(0.01393956,0,0,0.01393956,2.6491795,2.252306)" style="font-size:80px;font-family:brolink demo;-inkscape-font-specification:'Brolink DEMO, Normal';display:inline;opacity:.778276;stroke-width:37.9613;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:4.79781,9.59564"><g id="g34508" style="stroke-width:37.9613"><path d="m162.144 193.719s67.743-16.576 50.853-114.74c0 0 81.408-135.816 257.901-50.836.0.0-114.839 23.251-86.081 138.61.0.0-77.272-16.404-96.43 49.396.0.0-39.238-26.305-76.384 13.254.001.0-31.497 4.809-49.859-35.684z" fill="#5bc992" id="path34504" style="fill:#0d3758;fill-opacity:1;stroke-width:258.859"/><path d="m168.14 196.604c-3.557.0-6.756-2.472-7.539-6.09-.898-4.15 1.723-8.243 5.861-9.168 1.823-.428 42.24-10.743 40.627-79.558-.229-9.782-1.411-20.039-3.511-30.485l-2.197-10.93c-.84-4.18 1.868-8.251 6.048-9.092 4.184-.838 8.251 1.868 9.092 6.048l2.197 10.93c2.277 11.327 3.559 22.486 3.81 33.167.547 23.372-3.317 55.876-24.841 77.998-13.361 13.732-27.318 16.877-27.906 17.004-.55.118-1.1.176-1.641.176z" fill="#0bb494" id="path34506" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><g id="g34514" style="stroke-width:37.9613"><path d="m230.826 252.7c40.616-35.987 77.278-6.195 77.278-6.195 25.11-63.766 100.553-40.346 100.553-40.346-18.06-117.51 98.427-130.134 98.427-130.134-167.958-100.804-261.476 26.976-261.476 26.976 7.818 99.299-61.159 109.594-61.159 109.594s10.647 24.683 46.377 40.105z" fill="#6fd7a3" id="path34510" style="fill:#135587;fill-opacity:1;stroke-width:258.859"/><path d="m190.86 216.05c-3.848.0-7.177-2.872-7.655-6.788-.514-4.215 2.472-8.051 6.676-8.593 1.85-.258 43.048-6.821 47.752-75.499.668-9.759.432-20.08-.702-30.678l-1.186-11.085c-.453-4.24 2.616-8.046 6.856-8.499 4.242-.449 8.046 2.616 8.499 6.856l1.186 11.085c1.23 11.492 1.483 22.721.753 33.377-1.598 23.324-8.426 55.337-31.888 75.392-14.564 12.449-28.751 14.301-29.348 14.374-.316.039-.631.058-.943.058z" fill="#0bb494" id="path34512" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><path d="m99.22 32.25c54.02-16.304 94.124 31.976 82.031 97.634-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 7.207 128.69-146.88 153.812-189.774 79.616-38.092-65.889 25.07-126.332 25.07-126.332l15.768 13.085s-54.212 57.459-6.717 98.644c41.377 35.88 119.62 4.994 94.473-63.798-22.727-62.169-113.186-48.785-155.96-107.49C70.063 228.345 104.751 176.066 120.847 144.993c26.901-51.934 11.207-94.471-22.844-80.767z" fill="#c9f6b0" id="path34516" style="fill:#1b71af;fill-opacity:1;stroke-width:258.859"/><g id="g34520" style="stroke-width:37.9613"><path d="M328.066 390.702C323.797 314.463 265.762 273.176 230.826 252.7c-36.02-21.111-61.517-57.973-49.575-122.816C193.344 64.227 153.24 15.946 99.22 32.25l-.016.427c31.181 11.593 49.582 49.885 40.867 97.207-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 3.97 70.889-41.004 110.348-89.374 119.094 59.897 11.218 135.657-27.974 130.554-119.094z" fill="#bbf49b" id="path34518" style="fill:#155d91;fill-opacity:1;stroke-width:258.859"/></g><path d="M86.13 29.061 146.528.0s-10.295 53.02-52.157 74.817L75.834 69.492z" fill="#6fd7a3" id="path34522" style="fill:#0cf;fill-opacity:1;stroke-width:258.859"/><path d="m108.988.0-14.942 49.333.325 25.484c.132 10.356-5.648 19.894-14.922 24.625l-53.66 27.374C13.17 133.254-.159 119.45 6.856 107.202c8.309-14.507 17.855-31.646 27.245-49.53C41.851 42.911 53.79 30.729 68.409 22.59z" fill="#c9f6b0" id="path34524" style="fill:#2a95e1;fill-opacity:1;stroke-width:258.859"/><path d="m181.814 315.601c4.614-3.907 11.558.252 10.29 6.164l-6.293 29.354-7.207 33.619c-1.15 5.364-8.11 6.832-11.328 2.389L157.07 373.035c-1.033-1.427-2.614-2.359-4.362-2.573l-16.799-2.056c-5.486-.672-7.543-7.554-3.325-11.126l26.177-22.163z" fill="#6fd7a3" id="path34526" style="fill:#2ad4ff;fill-opacity:.992157;stroke-width:258.859"/><path d="m408.662 213.882c-2.855.0-5.599-1.59-6.939-4.325-.083-.168-8.514-17.05-27.948-36.153-17.846-17.542-48.949-40.642-95.775-51.077-4.162-.927-6.784-5.054-5.857-9.216.927-4.162 5.05-6.787 9.216-5.857 50.722 11.302 84.422 36.5 103.761 55.648 21.095 20.887 30.105 39.107 30.478 39.872 1.869 3.833.277 8.455-3.556 10.324-1.091.533-2.244.784-3.38.784z" fill="#0bb494" id="path34528" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><path d="m308.106 254.226c-.035.0-.068.0-.103-.001-4.254-.056-7.66-3.541-7.62-7.792.0-.459-.233-27.156-22.522-73.746-1.84-3.847-.214-8.457 3.633-10.298s8.457-.214 10.298 3.633c24.143 50.465 24.049 79.377 24.033 80.583-.056 4.231-3.502 7.621-7.719 7.621z" fill="#0bb494" id="path34530" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><g fill="#6fd7a3" id="g34540" style="display:inline;stroke-width:258.859"><path d="m293.41 353.127c-2.935.0-5.74-1.682-7.034-4.528-1.765-3.882-.048-8.459 3.834-10.224 6.955-3.161 18.792-10.715 18.911-10.791 3.592-2.297 8.368-1.248 10.665 2.345s1.248 8.367-2.345 10.665c-.522.334-12.881 8.222-20.84 11.839-1.036.47-2.122.694-3.191.694z" id="path34532" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m308.098 407.232c-4.104.0-7.52-3.231-7.707-7.372-.193-4.26 3.104-7.87 7.364-8.063l20.207-.915c4.259-.189 7.87 3.104 8.063 7.364s-3.104 7.87-7.364 8.063l-20.207.915c-.119.005-.238.008-.356.008z" id="path34534" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m310.641 470.991c-1.381.0-2.779-.37-4.042-1.148l-14.183-8.736c-3.631-2.236-4.762-6.993-2.525-10.623 2.236-3.632 6.993-4.762 10.623-2.525l14.184 8.736c3.631 2.236 4.762 6.993 2.525 10.623-1.459 2.368-3.99 3.673-6.582 3.673z" id="path34536" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m258.788 512c-2.901.0-5.679-1.642-6.994-4.441l-7.245-15.427c-1.813-3.86-.153-8.458 3.707-10.271 3.858-1.813 8.458-.153 10.271 3.707l7.245 15.427c1.813 3.86.153 8.458-3.707 10.271-1.06.498-2.177.734-3.277.734z" id="path34538" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/></g></g></g></svg></a><span class="badge bg-omvll d-none d-lg-inline-block"><strong>O-MVLL</strong></span></div><div class="offcanvas-header d-block d-lg-none border-bottom"><div class="d-flex align-items-center justify-content-between mb-3"><h5 class="d-lg-none mb-0">Menu</h5><button type=button class="btn-close d-lg-none" data-bs-dismiss=offcanvas data-bs-target=#docsNav></button></div><div class="list-group list-group-flush mx-n4"><a href=https://github.com/open-obfuscator/o-mvll target=_blank class="list-group-item list-group-item-action d-flex align-items-center border-0 py-2 px-4"><i class="fa-brands fa-github fs-lg opacity-80 me-2"></i>
Source Code
</a><a href=https://github.com/open-obfuscator/o-mvll/releases/ target=_blank class="list-group-item list-group-item-action d-flex align-items-center border-0 py-2 px-4"><i class="fa-solid fa-download fs-lg opacity-80 me-2"></i>
Download</a></div></div><div class="offcanvas-body p-4"><div class=swiper-wrapper><div class="swiper-slide h-auto"><h3 class=fs-lg><a href=https://obfuscator.re/omvll/introduction/>Introduction</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/introduction/getting-started/ class="list-group-item list-group-item-action border-0 py-2 px-4 active">Getting started
</a><a href=https://obfuscator.re/omvll/introduction/compilation/ class="list-group-item list-group-item-action border-0 py-2 px-4">Compilation
</a><a href=https://open-obfuscator.github.io/o-mvll target=_blank class="list-group-item list-group-item-action border-0 py-2 px-4">API</a></div><h3 class=fs-lg><a href=https://obfuscator.re/omvll/passes/>Obfuscation Passes</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/passes/anti-hook/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-tachograph-digital me-2"></span>
Anti-Hooking
</a><a href=https://obfuscator.re/omvll/passes/arithmetic/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-calculator-simple me-2"></span>
Arithmetic Obfuscation
</a><a href=https://obfuscator.re/omvll/passes/control-flow-breaking/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-chart-tree-map me-2"></span>
Control-Flow Breaking
</a><a href=https://obfuscator.re/omvll/passes/control-flow-flattening/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-cubes-stacked me-2"></span>
Control-Flow Flattening
</a><a href=https://obfuscator.re/omvll/passes/objcleaner/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-brands fa-apple me-2"></span>
Objective-C Cleaner
</a><a href=https://obfuscator.re/omvll/passes/opaque-constants/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-input-numeric me-2"></span>
Opaque Constants
</a><a href=https://obfuscator.re/omvll/passes/opaque-fields-access/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-arrow-right me-2"></span>
Opaque Fields Access
</a><a href=https://obfuscator.re/omvll/passes/strings-encoding/ class="list-group-item list-group-item-action border-0 py-2 px-4"><span class="fa-regular fa-square-a-lock me-2"></span>
Strings Encoding</a></div><h3 class=fs-lg><a href=https://obfuscator.re/omvll/other-topics/>Other Topics</a></h3><div class="list-group list-group-flush mx-n4 pb-2"><a href=https://obfuscator.re/omvll/other-topics/troubleshooting/ class="list-group-item list-group-item-action border-0 py-2 px-4">Troubleshooting
</a><a href=https://obfuscator.re/omvll/other-topics/jit/ class="list-group-item list-group-item-action border-0 py-2 px-4">LLVM JIT
</a><a href=https://obfuscator.re/omvll/other-topics/annotations/ class="list-group-item list-group-item-action border-0 py-2 px-4">Obfuscation Annotations</a></div></div></div><div class="swiper-scrollbar end-0"></div></div><div class="offcanvas-header border-top"><a href=https://obfuscator.re/ class="btn btn-primary w-100" target=_blank rel=noopener><i class="fa-sharp fa-solid fa-house-heart fs-4 lh-1 me-1"></i>
&nbsp;Home</a></div></div></aside><main class="docs-container pt-5 pb-3 pb-lg-4"><div class="container-fluid px-xxl-5 px-lg-4 pt-4 pt-lg-5 pb-4"><section class="container ms-0"><div class=row><div class="col-xl-7 col-lg-8 col-md-7 hugo-generated omvll"><h1 id=getting-started>Getting Started</h1><p>O-MVLL is an <strong>AArch64</strong> obfuscator designed to work with Android and iOS toolchains.
Theoretically, it could be run as simply as using the <code>-fpass-plugin=</code> compiler flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># Create/edit &#39;./omvll_config.py&#39; to configure the obfuscator and run:
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>$ clang <span style=color:#ff79c6>-</span>fpass<span style=color:#ff79c6>-</span>plugin<span style=color:#ff79c6>=</span>OMVLL.{so, dylib} main.c <span style=color:#ff79c6>-</span>o main
</span></span></code></pre></div><p><strong>Practically, there are additional configuration steps.</strong></p><h3 id=o-mvll-configuration-file>O-MVLL Configuration File</h3><p>Firstly, the O-MVLL&rsquo;s Python file is not always located next to the clang binary and we might want to change
the name of the file.</p><p>By default, O-MVLL tries to import <code>omvll_config.py</code> from <strong>the current directory</strong> in which <strong>clang is called</strong>.
If this file can&rsquo;t be resolved, it raises the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex;background-color:#3d3f4a><span>error: ModuleNotFoundError: No module named <span style=color:#f1fa8c>&#39;omvll_config&#39;</span>
</span></span><span style=display:flex><span>make: *** <span style=color:#ff79c6>[</span>Makefile:31: strings.bin<span style=color:#ff79c6>]</span> Error <span style=color:#bd93f9>1</span>
</span></span></code></pre></div><p>To get rid of both limitations: the name of the Python file and the location of the file, one can set the
<code>OMVLL_CONFIG</code> environment variable to the full path of your custom configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#3d3f4a><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_CONFIG</span><span style=color:#ff79c6>=</span>~/project/obfu/config_test.py
</span></span><span style=display:flex><span>clang -fpass-plugin<span style=color:#ff79c6>=</span>OMVLL.<span style=color:#ff79c6>{</span>so, dylib<span style=color:#ff79c6>}</span> main.c -o main
</span></span></code></pre></div><p>The O-MVLL configuration file must implements at least one function: <code>omvll_get_config</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> omvll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>omvll_get_config</span>() <span style=color:#ff79c6>-&gt;</span> omvll<span style=color:#ff79c6>.</span>ObfuscationConfig:
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Return an instance of `ObfuscationConfig` which
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    aims at describing the obfuscation scheme
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;&#34;&#34;</span>
</span></span></code></pre></div><p>This function is called by the pass plugin to access the obfuscation scheme defined by the user.
Since the instance of the configuration must be unique, we <strong>highly</strong> recommend wrapping this function with the
<code>@functools.lru_cache</code> decorator:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> omvll
</span></span><span style=display:flex;background-color:#3d3f4a><span><span style=color:#ff79c6>from</span> functools <span style=color:#ff79c6>import</span> lru_cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>@lru_cache(maxsize<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>omvll_get_config</span>() <span style=color:#ff79c6>-&gt;</span> omvll<span style=color:#ff79c6>.</span>ObfuscationConfig:
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Return an instance of `ObfuscationConfig` which
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    aims at describing the obfuscation scheme
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> MyConfig()
</span></span></code></pre></div><p>This decorator is used to get a <em>singleton</em> which simplifies the management of a global variable.</p><p>Then, the configuration of the obfuscations relies on implementing a class inheriting from <code>omvll.ObfuscationConfig</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> omvll
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> functools <span style=color:#ff79c6>import</span> lru_cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MyConfig</span>(omvll<span style=color:#ff79c6>.</span>ObfuscationConfig):
</span></span><span style=display:flex;background-color:#3d3f4a><span>    <span style=color:#ff79c6>def</span> __init__(self):
</span></span><span style=display:flex;background-color:#3d3f4a><span>        <span style=color:#8be9fd;font-style:italic>super</span>()<span style=color:#ff79c6>.</span>__init__()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@lru_cache(maxsize<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>omvll_get_config</span>() <span style=color:#ff79c6>-&gt;</span> omvll<span style=color:#ff79c6>.</span>ObfuscationConfig:
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Return an instance of `ObfuscationConfig` which
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    aims at describing the obfuscation scheme
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> MyConfig()
</span></span></code></pre></div><p><code>MyConfig</code> is the class that contains all the logic to define and configure the obfuscation scheme.
For instance, we can trigger the <a href=ref%20/omvll/passes/strings-encoding%20>strings encoding pass</a>
by implementing the function <code>obfuscate_string</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MyConfig</span>(omvll<span style=color:#ff79c6>.</span>ObfuscationConfig):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __init__(self):
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>super</span>()<span style=color:#ff79c6>.</span>__init__()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>obfuscate_string</span>(self, module: omvll<span style=color:#ff79c6>.</span>Module, func: omvll<span style=color:#ff79c6>.</span>Function,
</span></span><span style=display:flex;background-color:#3d3f4a><span>                               string: <span style=color:#8be9fd;font-style:italic>bytes</span>):
</span></span><span style=display:flex;background-color:#3d3f4a><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>        <span style=color:#ff79c6>if</span> func<span style=color:#ff79c6>.</span>demangled_name <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;Hello::say_hi()&#34;</span>:
</span></span><span style=display:flex;background-color:#3d3f4a><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>True</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;debug.cpp&#34;</span> <span style=color:#ff79c6>in</span> module<span style=color:#ff79c6>.</span>name:
</span></span><span style=display:flex;background-color:#3d3f4a><span>            <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;&lt;REMOVED&gt;&#34;</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>False</span>
</span></span></code></pre></div><h3 id=python-standard-library>Python Standard Library</h3><p>O-MVLL is statically linked with the Python VM. This static link allows us to <strong>not require</strong>
a specific version of Python installed on the system. On the other hand, the Python VM requires a path
to the directory where the Python Standard Library is installed (e.g. <code>/usr/lib/python3.10/</code>).</p><p>If the directory of the Python Standard Library can&rsquo;t be resolved, O-MVLL will raise an error like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;/cpython-install/lib/python310.zip&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;/cpython-install/lib/python3.10&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;/cpython-install/lib/lib-dynload&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>Fatal Python error: init_fs_encoding: failed to get the Python codec of the filesystem encoding
</span></span><span style=display:flex><span>Python runtime state: core initialized
</span></span><span style=display:flex><span>ModuleNotFoundError: No module named <span style=color:#f1fa8c>&#39;encodings&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Current thread 0x00007f612cb48040 <span style=color:#ff79c6>(</span>most recent call first<span style=color:#ff79c6>)</span>:
</span></span><span style=display:flex><span>  &lt;no Python frame&gt;
</span></span></code></pre></div><p>If this error is triggered, we can download the Python source code associated with the version used
in O-MVLL and set the environment variable <code>OMVLL_PYTHONPATH</code> to the <code>Lib/</code> directory.</p><p>Here is an example with Python 3.10:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://www.python.org/ftp/python/3.10.7/Python-3.10.7.tgz
</span></span><span style=display:flex><span>tar xzvf Python-3.10.7.tgz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3d3f4a><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_PYTHONPATH</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/Python-3.10.7/Lib
</span></span><span style=display:flex><span>clang -fpass-plugin<span style=color:#ff79c6>=</span>OMVLL.<span style=color:#ff79c6>{</span>so, dylib<span style=color:#ff79c6>}</span> main.c -o main
</span></span></code></pre></div><h3 id=yaml-configuration-file>YAML Configuration File</h3><p>Setting environment variables is not always easy, especially with IDE like Xcode and Android Studio.</p><p>For this reason, O-MVLL is also aware of an <code>omvll.yml</code> file that would be present in the directories
from the root <code>/</code> to the current working directory.</p><p>For instance, if the compiler is called from:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/home/romain/dev/o-mvll/test/build
</span></span></code></pre></div><p>O-MVLL will check if a file <code>omvll.yml</code> is present in the following paths:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/home/romain/dev/o-mvll/test/build/omvll.yml
</span></span><span style=display:flex><span>/home/romain/dev/o-mvll/test/omvll.yml
</span></span><span style=display:flex><span>/home/romain/dev/o-mvll/omvll.yml
</span></span><span style=display:flex><span>/home/romain/dev/omvll.yml
</span></span><span style=display:flex><span>/home/romain/omvll.yml
</span></span><span style=display:flex><span>/home/omvll.yml
</span></span><span style=display:flex><span>/omvll.yml
</span></span></code></pre></div><p>If this file exists, it will load the following keys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>OMVLL_PYTHONPATH</span>: <span style=color:#f1fa8c>&#34;&lt;mirror of $OMVLL_PYTHONPATH&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>OMVLL_CONFIG</span>:     <span style=color:#f1fa8c>&#34;&lt;mirror of $OMVLL_CONFIG&gt;&#34;</span>
</span></span></code></pre></div><h2 id=android-ndk>Android NDK</h2><p>The toolchain provided by the Android NDK is based on LLVM and <strong>linked with <code>libc++</code></strong>.
To avoid ABI issues, O-MVLL (and its dependencies) are also compiled and linked using <code>libc++</code>.</p><p>Most of the Linux distributions provide by default the GNU C++ standard library, aka <code>libstdc++</code>, and not
the LLVM-based standard library, <code>libc++</code>.</p><p>Since <code>libc++.so</code> is not usually installed on the system, when clang tries to dynamically load <code>OMVLL.so</code>,
it fails with the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ clang -fpass-plugin<span style=color:#ff79c6>=</span>./OMVLL.so main.c -o main
</span></span><span style=display:flex><span>Could not load library <span style=color:#f1fa8c>&#39;./OMVLL.so&#39;</span>:
</span></span><span style=display:flex><span>libc++abi.so.1: cannot open shared object file: No such file or directory
</span></span></code></pre></div><p>To prevent this error, we must add the NDK directory that contains <code>libc++.so</code> and <code>libc++abi.so.1</code>
in the list of the lookup directories. This can be done by setting the environment variable <code>LD_LIBRARY_PATH</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LD_LIBRARY_PATH</span><span style=color:#ff79c6>=</span>&lt;NDK_HOME&gt;/toolchains/llvm/prebuilt/linux-x86_64/lib64
</span></span></code></pre></div><p><code>&lt;NDK_HOME></code> is the root directory of the NDK. If the NDK is installed along with the Android SDK,
it should be located in <code>$ANDROID_HOME/ndk/24.0.8215888</code> for the version <code>24.0.8215888</code>.</p><div class="alert d-flex alert-dark" role=alert style=max-width:1024px><i class="fa-regular fa-face-thinking lead me-3"></i><div>The <code>clang</code> binary provided in the NDK is also linked with <code>libc++.so</code> but we don&rsquo;t need to manually provide the <code>lib64</code>
directory as it uses a <code>RUNPATH</code> set to <code>$ORIGIN/../lib64</code>.</div></div><h3 id=gradle-integration>Gradle Integration</h3><p>Within an Android project, we can setup O-MVLL by using the <code>cppFlags, cFlags</code> attributes in the
<a href=https://developer.android.com/reference/tools/gradle-api/7.0/com/android/build/api/dsl/ExternalNativeCmakeOptions>ExternalNativeCmakeOptions</a>
DSL block:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-gradle data-lang=gradle><span style=display:flex><span>android <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    compileSdkVersion <span style=color:#bd93f9>30</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>    ndkVersion        <span style=color:#f1fa8c>&#34;25.0.8775105&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>...</span>
</span></span><span style=display:flex><span>    buildTypes <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>      release <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>        ndk<span style=color:#ff79c6>.</span><span style=color:#50fa7b>abiFilters</span> <span style=color:#f1fa8c>&#39;arm64-v8a&#39;</span> <span style=color:#6272a4>// Force ARM64
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        externalNativeBuild <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>          cmake <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>            cppFlags <span style=color:#f1fa8c>&#39;-fpass-plugin=&lt;path&gt;/OMVLL.so&#39;</span>
</span></span><span style=display:flex;background-color:#3d3f4a><span>            cFlags   <span style=color:#f1fa8c>&#39;-fpass-plugin=&lt;path&gt;/OMVLL.so&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}}}</span>
</span></span></code></pre></div><p>There are important options associated with this configuration:</p><ul><li><code>ndkVersion</code> must match the NDK version for which O-MVLL has been downloaded.</li><li><code>ndk.abiFilters</code> must <strong>always</strong> be <code>'arm64-v8a'</code> since O-MVLL <strong>only supports this architecture</strong>.</li></ul><div class="alert d-flex alert-success" role=alert style=max-width:1024px><i class="fa-regular fa-option lead me-3"></i><div>As a side effect of only supporting <code>AArch64</code>, a released APK that only embeds <code>arm64-v8a</code> native libraries
is a simple way to limit code emulation and code lifting.</div></div><p>In addition, we might need to satisfy the environment variables mentioned previously
(<code>LD_LIBRARY_PATH</code>, <code>OMVLL_CONFIG</code>, &mldr;).</p><p>To expose these variables, we can create an environment file, <code>omvll.env</code>, that defines the variables and
which is <em>sourced</em> before running Gradle or Android Studio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># File: omvll.env</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>NDK_VERSION</span><span style=color:#ff79c6>=</span>25.0.8775105
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>LD_LIBRARY_PATH</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>/ndk/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>NDK_VERSION</span><span style=color:#f1fa8c>}</span>/toolchains/llvm/prebuilt/linux-x86_64/lib64
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_CONFIG</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#ff79c6>)</span>/app/o-config.py
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_PYTHONPATH</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$HOME</span>/path/python/Python-3.10.7/Lib
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>source</span> ./omvll.env
</span></span><span style=display:flex><span>$ ./gradlew assembleRelease
</span></span><span style=display:flex><span><span style=color:#6272a4># Or Android Studio:</span>
</span></span><span style=display:flex><span>$ studio.sh
</span></span></code></pre></div><p>In the end, the Android project might follow this layout:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-txt data-lang=txt><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── app
</span></span><span style=display:flex><span>│   ├── build.gradle
</span></span><span style=display:flex;background-color:#3d3f4a><span>│   ├── o-config.py
</span></span><span style=display:flex><span>│   └── src
</span></span><span style=display:flex><span>├── build.gradle
</span></span><span style=display:flex><span>├── gradle
</span></span><span style=display:flex><span>│   └── wrapper
</span></span><span style=display:flex><span>├── gradle.properties
</span></span><span style=display:flex><span>├── gradlew
</span></span><span style=display:flex><span>├── local.properties
</span></span><span style=display:flex;background-color:#3d3f4a><span>├── omvll.env
</span></span><span style=display:flex><span>└── settings.gradle
</span></span></code></pre></div><p>Alternatively, you could also create an <code>omvll.yml</code> file next to the <code>omvll.env</code> but the <code>LD_LIBRARY_PATH</code> still
needs to be set.</p><div class="alert d-flex alert-warning" role=alert style=max-width:1024px><i class="fa-regular fa-code-commit lead me-3"></i><div>It can be worth adding <code>o-config.py</code>, <code>omvll.yml</code>, and <code>omvll.env</code> in <code>.gitignore</code> to avoid leaks.</div></div><h2 id=android-ndk-wsl>Android NDK (WSL)</h2><div class="alert d-flex alert-success" role=alert style=max-width:1024px><div><em>Thank you to <a href=https://sirionrazzer.github.io/blog/>Tomáš Soukal</a> from <a href=https://www.talsec.app/>Talsec</a>
for this section.</em></div></div><h3 id=preparing-the-wsl-for-commandline-android-development>Preparing the WSL for commandline Android development</h3><p>Based on this article <a href=https://dev.to/halimsamy/wsl-for-developers-installing-the-android-sdk-53n9>WSL for Developers!: Installing the Android SDK</a></p><h4 id=installing-openjdk-and-gradle>Installing OpenJDK and Gradle</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt install openjdk-8-jdk-headless gradle
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>JAVA_HOME</span><span style=color:#ff79c6>=</span>/usr/lib/jvm/java-8-openjdk-amd64
</span></span></code></pre></div><h4 id=installing-android-command-line-tools>Installing Android Command Line Tools</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd</span> ~ <span style=color:#6272a4># Make sure you are at home!</span>
</span></span><span style=display:flex><span>curl https://dl.google.com/android/repository/commandlinetools-linux-8512546_latest.zip -o /tmp/cmd-tools.zip
</span></span><span style=display:flex><span>mkdir -p android/cmdline-tools
</span></span><span style=display:flex><span>unzip -q -d android/cmdline-tools /tmp/cmd-tools.zip
</span></span><span style=display:flex><span>mv android/cmdline-tools/cmdline-tools android/cmdline-tools/latest
</span></span><span style=display:flex><span>rm /tmp/cmd-tools.zip <span style=color:#6272a4># delete the zip file (optional)</span>
</span></span></code></pre></div><h4 id=setting-up-environment-variables>Setting up environment variables</h4><p>You could possibly join include these lines in <code>omvll.env</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>JAVA_HOME</span><span style=color:#ff79c6>=</span>/usr/lib/jvm/java-8-openjdk-amd64
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$HOME</span>/android
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>ANDROID_SDK_ROOT</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>PATH</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>/cmdline-tools/latest/bin:<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>/platform-tools:<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>/tools:<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ANDROID_HOME</span><span style=color:#f1fa8c>}</span>/tools/bin:<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>PATH</span><span style=color:#f1fa8c>}</span>
</span></span></code></pre></div><h4 id=accepting-sdk-licenses>Accepting SDK licenses</h4><p>You will find sdkmanager in /tools/bin/sdkmanager:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yes | sdkmanager --licenses
</span></span></code></pre></div><h4 id=installing-sdk-components>Installing SDK components</h4><ul><li>pay attention to use ndk version matching the downloaded obfuscator (I used <code>25.0.8775105 - omvll_ndk_r25.so</code>)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./sdkmanager --update
</span></span><span style=display:flex><span>./sdkmanager <span style=color:#f1fa8c>&#34;platforms;android-31&#34;</span> <span style=color:#f1fa8c>&#34;build-tools;31.0.0&#34;</span> <span style=color:#f1fa8c>&#34;ndk;25.0.8775105&#34;</span> <span style=color:#f1fa8c>&#34;platform-tools&#34;</span>
</span></span></code></pre></div><h3 id=obfuscator-related-changes>Obfuscator related changes</h3><h4 id=buildgradle>build.gradle</h4><ul><li>adjust path to obfuscator binary <code>omvll_ndk_r25.so</code>, change &rsquo;tom&rsquo; to your username:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>externalNativeBuild <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    cmake <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        cppFlags <span style=color:#f1fa8c>&#34;-std=c++14 -frtti -fexceptions
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                  -fpass-plugin=/mnt/c/Users/tom/path-to-project/omvll_ndk_r25.so&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><h4 id=omvllenv>omvll.env</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>NDK_VERSION</span><span style=color:#ff79c6>=</span>25.0.8775105
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>LD_LIBRARY_PATH</span><span style=color:#ff79c6>=</span>/home/tom/android/ndk/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>NDK_VERSION</span><span style=color:#f1fa8c>}</span>/toolchains/llvm/prebuilt/linux-x86_64/lib64
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_CONFIG</span><span style=color:#ff79c6>=</span>/mnt/c/Users/tom/path-to-project/omvll-config.py
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>OMVLL_PYTHONPATH</span><span style=color:#ff79c6>=</span>/mnt/c/Users/tom/path-to-project/Python-3.10.7/Lib
</span></span></code></pre></div><h4 id=localproperties>local.properties</h4><p>I needed to adjust the line with <code>sdk.dir</code> in the <code>local.properties</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#50fa7b>...</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>sdk.dir</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>/home/tom/android</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>...</span>
</span></span></code></pre></div><h4 id=troubleshooting>Troubleshooting</h4><p>I ran into this issue when running gradlew,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>env: bash<span style=color:#f1fa8c>\r</span>: No such file or directory
</span></span></code></pre></div><p>The following change helped me:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim gradlew
</span></span><span style=display:flex><span>:set <span style=color:#8be9fd;font-style:italic>fileformat</span><span style=color:#ff79c6>=</span>unix
</span></span><span style=display:flex><span>:wq
</span></span></code></pre></div><p>Finally:</p><p><code>gradlew clean build</code>, <code>gradlew assembleRelease</code>, or whatever you like :)</p><h2 id=ios>iOS</h2><p>Using O-MVLL with Xcode is a bit easier than Android since we don&rsquo;t need to deal with different <code>libstdc++/libc++</code>.
To enable O-MVLL, one needs to go to:</p><p><code>Build Settings > Apple Clang - Custom Compiler Flags > Other C/C++ Flags</code></p><p>and add <code>-fpass-plugin=&lt;path>/omvll_xcode_14.dylib</code>. We also need to disable the legacy pass manager with:
<code>-fno-legacy-pass-manager</code>.</p><p>Finally, we can create an <code>omvll.yml</code> file next to the <code>*.xcodeproj</code> file which defines <code>OMVLL_PYTHONPATH</code> and <code>OMVLL_CONFIG</code>.</p><p>Et voila :)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>OMVLL_PYTHONPATH</span>: <span style=color:#f1fa8c>&#34;/Users/romain/Downloads/Python-3.10.8/Lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>OMVLL_CONFIG</span>:     <span style=color:#f1fa8c>&#34;/Users/romain/dev/ios-app/demo/omvll_conf/base.py&#34;</span>
</span></span></code></pre></div><h2 id=code-completion>Code Completion</h2><p>The PyPI package <a href=https://pypi.org/project/omvll/1.0.0/><code>omvll</code></a> can be used to get code completion
while using O-MVLL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python -m pip install <span style=color:#ff79c6>[</span>--user<span style=color:#ff79c6>]</span> omvll
</span></span></code></pre></div><p><img src=./img/completion.webp alt="O-MVLL Code Completion" title="O-MVLL Code Completion"></p><h2 id=requirements-and-limitations>Requirements and Limitations</h2><div class="card card-body dark-mode border-0 shadow-sm position-relative overflow-hidden ps-sm-5 mb-5 mt-5"><div class="position-absolute top-0 start-0 w-3 h-100 bg-danger"></div><div class="d-flex align-items-start border-bottom pb-3"><i class="fa-regular fa-triangle-exclamation fs-xl text-danger"></i><div class="ps-2 ms-1"><h6 class="opacity-80 mb-1">Cross Compilation</h6></div></div><div class=pt-3><div class="d-flex align-items-start pb-3"><div><p>O-MVLL is currently tested and CI-compiled for the following configurations:</p><ul><li><strong>Android NDK</strong>: (Linux Debian Stretch)</li><li><strong>iOS</strong>: OSX 11 (arm64 & x86-64)</li></ul><center><strong class=text-danger>In particular, we did not test and we do not provide O-MVLL for cross-compiling Android projects on OSX and
Windows</strong></center></div></div></div></div><h2 id=nightly-packages>Nightly Packages</h2><p>There is a CI for O-MVLL. For <strong>all builds</strong>, the packages are <em>nightly</em> uploaded at the following addresses:</p><ul><li>Nightly: <a href=http://nightly.obfuscator.re/latest/omvll>http://nightly.obfuscator.re/latest/omvll</a></li><li>Experimental: <a href=https://open-obfuscator.build38.io/ci/index.html>https://open-obfuscator.build38.io/ci/index.html</a></li><li>CI: <a href=https://github.com/open-obfuscator/o-mvll/actions>https://github.com/open-obfuscator/o-mvll/actions</a></li></ul><p>Thus, one can enjoy a beta version before waiting for a final release.</p><h2 id=environment-variables>Environment Variables</h2><table><thead><tr><th>Environment Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>OMVLL_PYTHONPATH</code></td><td>Path to the Python Standard Library (which contains <code>abc.py</code>)</td></tr><tr><td><code>OMVLL_CONFIG</code></td><td>Path to the O-MVLL Configuration file (default is <code>./omvll_config.py</code>)</td></tr></tbody></table><h2 id=yaml-keys>YAML Keys</h2><table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody><tr><td><code>OMVLL_PYTHONPATH</code></td><td>Path to the Python Standard Library (which contains <code>abc.py</code>)</td></tr><tr><td><code>OMVLL_CONFIG</code></td><td>Path to the O-MVLL Configuration file (default is <code>./omvll_config.py</code>)</td></tr></tbody></table><h6 id=example>Example:</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>OMVLL_PYTHONPATH</span>: <span style=color:#f1fa8c>&#34;&lt;path&gt;/Python-3.10.8/Lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>OMVLL_CONFIG</span>:     <span style=color:#f1fa8c>&#34;&lt;path&gt;/myconfig.py&#34;</span>
</span></span></code></pre></div></div></div><nav class=pb-5><ul class="pagination d-flex justify-content-left"><li class=page-item><a href=https://obfuscator.re/omvll/introduction/ class="page-link link-dprotect"><i class="fa-regular fa-chevrons-left ms-n1 me-1 fs-xs"></i>
Introduction</a></li><li class=page-item><a href=https://obfuscator.re/omvll/introduction/compilation/ class=page-link>Compilation
<i class="fa-regular fa-chevrons-right me-n1 ms-1 fs-xs"></i></a></li></ul></nav></main><aside id=jumpToNav class="side-nav side-nav-end d-none d-xxl-block position-fixed top-0 end-0 vh-100 py-5" style=width:20rem><h3 class="fs-lg mt-5 pt-5">Jump to</h3><ul class=nav><li class=nav-item><a class=nav-link href=#android-ndk data-scroll data-scroll-offset=-6>Android NDK</a></li><li class=nav-item><a class=nav-link href=#android-ndk-wsl data-scroll data-scroll-offset=-6>Android NDK (WSL)</a></li><li class=nav-item><a class=nav-link href=#ios data-scroll data-scroll-offset=-6>iOS</a></li><li class=nav-item><a class=nav-link href=#code-completion data-scroll data-scroll-offset=-6>Code Completion</a></li><li class=nav-item><a class=nav-link href=#requirements-and-limitations data-scroll data-scroll-offset=-6>Requirements and Limitations</a></li><li class=nav-item><a class=nav-link href=#nightly-packages data-scroll data-scroll-offset=-6>Nightly Packages</a></li><li class=nav-item><a class=nav-link href=#environment-variables data-scroll data-scroll-offset=-6>Environment Variables</a></li><li class=nav-item><a class=nav-link href=#yaml-keys data-scroll data-scroll-offset=-6>YAML Keys</a></li></ul></aside></main><footer class="footer dark-mode bg-dark pt-5 pb-4 pb-lg-5"><div class="container text-center pt-lg-3"><p class="nav d-block fs-sm text-center pt-5 mt-lg-4 mb-0"><span class="text-light opacity-50">Site generated with </span><a class="nav-link d-inline-block p-0" href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>
<span class="text-light opacity-50">and created by</span>
<a class="nav-link d-inline-block p-0" href=https://www.romainthomas.fr/ target=_blank rel=noopener>R. Thomas</a></p></div></footer><noscript><div class="navbar navbar-expand-lg navbar-dark shadow-sm fixed-bottom d-flex justify-content-center align-items-center"><div class="alert alert-warning fade show" role=alert><i class="fa-solid fa-gingerbread-man me-2"></i>
This website is free from cookies, trackers, and ads but you might want to enable javascript for a
better UI experience.</div></div></noscript><script src=/vendor/bootstrap/dist/js/bootstrap.bundle.min.js></script><script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script><script src=/vendor/parallax-js/dist/parallax.min.js></script><script src=/vendor/jarallax/dist/jarallax.min.js></script><script src=/vendor/rellax/rellax.min.js></script><script src=/vendor/swiper/swiper-bundle.min.js></script><script src=/vendor/lightgallery/lightgallery.min.js></script><script src=/vendor/lightgallery/plugins/video/lg-video.min.js></script><script>jarallax(document.querySelectorAll(".jarallax"),{speed:.2})</script><script src=/js/theme.min.js></script><script src=/js/anime.min.js></script></body></html>