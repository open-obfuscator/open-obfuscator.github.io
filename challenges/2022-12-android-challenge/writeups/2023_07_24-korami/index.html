<!doctype html><html class=dark-mode lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=manifest href=manifest.webmanifest><link rel=icon type=image/svg+xml href=/favicon/favicon.svg><link rel=icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_32x32_fill_box_center_3.png><link rel="shortcut icon" type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><link rel=apple-touch-icon type=image/png href=/favicon/favicon_hue529d2a9513ea41889fd87b18b80b0ed_11211_192x192_fill_box_center_3.png><meta name=description content="Writeup for obfuscator.re Challenge 1 The application has a simple login screen:
Login screen Checking the source code in jadx:
$ jadx-gui apks/challenge-pydroid.apk 2>&amp;1 >/dev/null & We see that the code behind the check is inside a native function:
Installing the app and running frida:
$ adb install apks/challenge-pydroid.apk Searching for system.load in jadx we can find where the lib is being loaded: Let&rsquo;s write a script to decrypt the string and see what the name of the lib that is being loaded:"><meta property="og:type" content="website"><meta property="og:description" content="Writeup for obfuscator.re Challenge 1 The application has a simple login screen:
Login screen Checking the source code in jadx:
$ jadx-gui apks/challenge-pydroid.apk 2>&amp;1 >/dev/null & We see that the code behind the check is inside a native function:
Installing the app and running frida:
$ adb install apks/challenge-pydroid.apk Searching for system.load in jadx we can find where the lib is being loaded: Let&rsquo;s write a script to decrypt the string and see what the name of the lib that is being loaded:"><meta property="og:title" content="Writeup by korami | Open Obfuscator"><meta property="og:site_name" content="Open Obfuscator: A free and open-source solution for obfuscating mobile applications."><meta property="og:url" content="https://obfuscator.re/challenges/2022-12-android-challenge/writeups/2023_07_24-korami/"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2023-08-20T20:11:29+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@open_obfuscator"><meta name=twitter:creator content="@rh0main"><meta name=twitter:title content="Writeup by korami | Open Obfuscator"><meta name=twitter:description content="Writeup for obfuscator.re Challenge 1 The application has a simple login screen:
Login screen Checking the source code in jadx:
$ jadx-gui apks/challenge-pydroid.apk 2>&amp;1 >/dev/null & We see that the code behind the check is inside a native function:
Installing the app and running frida:
$ adb install apks/challenge-pydroid.apk Searching for system.load in jadx we can find where the lib is being loaded: Let&rsquo;s write a script to decrypt the string and see what the name of the lib that is being loaded:"><meta name=twitter:domain content="https://obfuscator.re/challenges/2022-12-android-challenge/writeups/2023_07_24-korami/"><title>Writeup by korami | Challenges</title><link rel=canonical href=https://obfuscator.re/challenges/2022-12-android-challenge/writeups/2023_07_24-korami/><link rel=stylesheet href=/css/fa-all.min.css><link rel=stylesheet href=/vendor/swiper/swiper-bundle.min.css><link rel=stylesheet href=/vendor/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/css/theme.min.css></head><body><main class=page-wrapper><header class="header navbar navbar-expand-lg navbar-dark position-absolute navbar-sticky"><div class="container px-3"><a href=https://obfuscator.re/ class="navbar-brand pe-3"><svg width="44.142574" height="40.444458" viewBox="0 0 11.679389 10.70093" id="svg20282" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14, custom)" sodipodi:docname="logo.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><sodipodi:namedview id="namedview20284" pagecolor="#ffffff" bordercolor="#000000" borderopacity=".25" inkscape:showpageshadow="2" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" showgrid="false" inkscape:zoom="7.319248" inkscape:cx="51.576337" inkscape:cy="24.661003" inkscape:window-width="1714" inkscape:window-height="1411" inkscape:window-x="1720" inkscape:window-y="23" inkscape:window-maximized="1" inkscape:current-layer="layer1"/><defs id="defs20279"/><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-0.38727107,-0.37705709)"><g id="g34542" transform="matrix(0.01393956,0,0,0.01393956,0.31874133,0.37705711)" style="font-size:80px;font-family:brolink demo;-inkscape-font-specification:'Brolink DEMO, Normal';display:inline;opacity:.778276;stroke-width:37.9613;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:4.79781,9.59564" inkscape:label="mascott"><g id="g34508" style="stroke-width:37.9613"><path d="m162.144 193.719s67.743-16.576 50.853-114.74c0 0 81.408-135.816 257.901-50.836.0.0-114.839 23.251-86.081 138.61.0.0-77.272-16.404-96.43 49.396.0.0-39.238-26.305-76.384 13.254.001.0-31.497 4.809-49.859-35.684z" fill="#5bc992" id="path34504" style="fill:#0d3758;fill-opacity:1;stroke-width:258.859"/><path d="m168.14 196.604c-3.557.0-6.756-2.472-7.539-6.09-.898-4.15 1.723-8.243 5.861-9.168 1.823-.428 42.24-10.743 40.627-79.558-.229-9.782-1.411-20.039-3.511-30.485l-2.197-10.93c-.84-4.18 1.868-8.251 6.048-9.092 4.184-.838 8.251 1.868 9.092 6.048l2.197 10.93c2.277 11.327 3.559 22.486 3.81 33.167.547 23.372-3.317 55.876-24.841 77.998-13.361 13.732-27.318 16.877-27.906 17.004-.55.118-1.1.176-1.641.176z" fill="#0bb494" id="path34506" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><g id="g34514" style="stroke-width:37.9613"><path d="m230.826 252.7c40.616-35.987 77.278-6.195 77.278-6.195 25.11-63.766 100.553-40.346 100.553-40.346-18.06-117.51 98.427-130.134 98.427-130.134-167.958-100.804-261.476 26.976-261.476 26.976 7.818 99.299-61.159 109.594-61.159 109.594s10.647 24.683 46.377 40.105z" fill="#6fd7a3" id="path34510" style="fill:#135587;fill-opacity:1;stroke-width:258.859"/><path d="m190.86 216.05c-3.848.0-7.177-2.872-7.655-6.788-.514-4.215 2.472-8.051 6.676-8.593 1.85-.258 43.048-6.821 47.752-75.499.668-9.759.432-20.08-.702-30.678l-1.186-11.085c-.453-4.24 2.616-8.046 6.856-8.499 4.242-.449 8.046 2.616 8.499 6.856l1.186 11.085c1.23 11.492 1.483 22.721.753 33.377-1.598 23.324-8.426 55.337-31.888 75.392-14.564 12.449-28.751 14.301-29.348 14.374-.316.039-.631.058-.943.058z" fill="#0bb494" id="path34512" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/></g><path d="m99.22 32.25c54.02-16.304 94.124 31.976 82.031 97.634-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 7.207 128.69-146.88 153.812-189.774 79.616-38.092-65.889 25.07-126.332 25.07-126.332l15.768 13.085s-54.212 57.459-6.717 98.644c41.377 35.88 119.62 4.994 94.473-63.798-22.727-62.169-113.186-48.785-155.96-107.49C70.063 228.345 104.751 176.066 120.847 144.993c26.901-51.934 11.207-94.471-22.844-80.767z" fill="#c9f6b0" id="path34516" style="fill:#1b71af;fill-opacity:1;stroke-width:258.859"/><g id="g34520" style="stroke-width:37.9613"><path d="M328.066 390.702C323.797 314.463 265.762 273.176 230.826 252.7c-36.02-21.111-61.517-57.973-49.575-122.816C193.344 64.227 153.24 15.946 99.22 32.25l-.016.427c31.181 11.593 49.582 49.885 40.867 97.207-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 3.97 70.889-41.004 110.348-89.374 119.094 59.897 11.218 135.657-27.974 130.554-119.094z" fill="#bbf49b" id="path34518" style="fill:#155d91;fill-opacity:1;stroke-width:258.859"/></g><path d="M86.13 29.061 146.528.0s-10.295 53.02-52.157 74.817L75.834 69.492z" fill="#6fd7a3" id="path34522" style="fill:#0cf;fill-opacity:1;stroke-width:258.859"/><path d="m108.988.0-14.942 49.333.325 25.484c.132 10.356-5.648 19.894-14.922 24.625l-53.66 27.374C13.17 133.254-.159 119.45 6.856 107.202c8.309-14.507 17.855-31.646 27.245-49.53C41.851 42.911 53.79 30.729 68.409 22.59z" fill="#c9f6b0" id="path34524" style="fill:#2a95e1;fill-opacity:1;stroke-width:258.859"/><path d="m181.814 315.601c4.614-3.907 11.558.252 10.29 6.164l-6.293 29.354-7.207 33.619c-1.15 5.364-8.11 6.832-11.328 2.389L157.07 373.035c-1.033-1.427-2.614-2.359-4.362-2.573l-16.799-2.056c-5.486-.672-7.543-7.554-3.325-11.126l26.177-22.163z" fill="#6fd7a3" id="path34526" style="fill:#2ad4ff;fill-opacity:.992157;stroke-width:258.859"/><path d="m408.662 213.882c-2.855.0-5.599-1.59-6.939-4.325-.083-.168-8.514-17.05-27.948-36.153-17.846-17.542-48.949-40.642-95.775-51.077-4.162-.927-6.784-5.054-5.857-9.216.927-4.162 5.05-6.787 9.216-5.857 50.722 11.302 84.422 36.5 103.761 55.648 21.095 20.887 30.105 39.107 30.478 39.872 1.869 3.833.277 8.455-3.556 10.324-1.091.533-2.244.784-3.38.784z" fill="#0bb494" id="path34528" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><path d="m308.106 254.226c-.035.0-.068.0-.103-.001-4.254-.056-7.66-3.541-7.62-7.792.0-.459-.233-27.156-22.522-73.746-1.84-3.847-.214-8.457 3.633-10.298s8.457-.214 10.298 3.633c24.143 50.465 24.049 79.377 24.033 80.583-.056 4.231-3.502 7.621-7.719 7.621z" fill="#0bb494" id="path34530" style="fill:#59aae8;fill-opacity:.992157;stroke-width:258.859"/><g fill="#6fd7a3" id="g34540" style="display:inline;stroke-width:258.859"><path d="m293.41 353.127c-2.935.0-5.74-1.682-7.034-4.528-1.765-3.882-.048-8.459 3.834-10.224 6.955-3.161 18.792-10.715 18.911-10.791 3.592-2.297 8.368-1.248 10.665 2.345s1.248 8.367-2.345 10.665c-.522.334-12.881 8.222-20.84 11.839-1.036.47-2.122.694-3.191.694z" id="path34532" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m308.098 407.232c-4.104.0-7.52-3.231-7.707-7.372-.193-4.26 3.104-7.87 7.364-8.063l20.207-.915c4.259-.189 7.87 3.104 8.063 7.364s-3.104 7.87-7.364 8.063l-20.207.915c-.119.005-.238.008-.356.008z" id="path34534" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m310.641 470.991c-1.381.0-2.779-.37-4.042-1.148l-14.183-8.736c-3.631-2.236-4.762-6.993-2.525-10.623 2.236-3.632 6.993-4.762 10.623-2.525l14.184 8.736c3.631 2.236 4.762 6.993 2.525 10.623-1.459 2.368-3.99 3.673-6.582 3.673z" id="path34536" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/><path d="m258.788 512c-2.901.0-5.679-1.642-6.994-4.441l-7.245-15.427c-1.813-3.86-.153-8.458 3.707-10.271 3.858-1.813 8.458-.153 10.271 3.707l7.245 15.427c1.813 3.86.153 8.458-3.707 10.271-1.06.498-2.177.734-3.277.734z" id="path34538" style="fill:#2b97e2;fill-opacity:.992157;stroke-width:37.9613"/></g></g><g id="g49341" transform="matrix(-0.01393956,0,0,0.01393956,12.135191,3.9409316)" style="font-size:80px;font-family:brolink demo;-inkscape-font-specification:'Brolink DEMO, Normal';display:inline;opacity:.778276;stroke-width:37.9613;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:4.79781,9.59566" inkscape:label="mascott"><g id="g49307" style="stroke-width:37.9613"><path d="m162.144 193.719s67.743-16.576 50.853-114.74c0 0 81.408-135.816 257.901-50.836.0.0-114.839 23.251-86.081 138.61.0.0-77.272-16.404-96.43 49.396.0.0-39.238-26.305-76.384 13.254.001.0-31.497 4.809-49.859-35.684z" fill="#5bc992" id="path49303" style="fill:#7c232d;fill-opacity:.992157;stroke-width:258.859"/><path d="m168.14 196.604c-3.557.0-6.756-2.472-7.539-6.09-.898-4.15 1.723-8.243 5.861-9.168 1.823-.428 42.24-10.743 40.627-79.558-.229-9.782-1.411-20.039-3.511-30.485l-2.197-10.93c-.84-4.18 1.868-8.251 6.048-9.092 4.184-.838 8.251 1.868 9.092 6.048l2.197 10.93c2.277 11.327 3.559 22.486 3.81 33.167.547 23.372-3.317 55.876-24.841 77.998-13.361 13.732-27.318 16.877-27.906 17.004-.55.118-1.1.176-1.641.176z" fill="#0bb494" id="path49305" style="fill:#f45b69;fill-opacity:.992157;stroke-width:258.859"/></g><g id="g49313" style="stroke-width:37.9613"><path d="m230.826 252.7c40.616-35.987 77.278-6.195 77.278-6.195 25.11-63.766 100.553-40.346 100.553-40.346-18.06-117.51 98.427-130.134 98.427-130.134-167.958-100.804-261.476 26.976-261.476 26.976 7.818 99.299-61.159 109.594-61.159 109.594s10.647 24.683 46.377 40.105z" fill="#6fd7a3" id="path49309" style="fill:#9c2d3c;fill-opacity:.992157;stroke-width:258.859"/><path d="m190.86 216.05c-3.848.0-7.177-2.872-7.655-6.788-.514-4.215 2.472-8.051 6.676-8.593 1.85-.258 43.048-6.821 47.752-75.499.668-9.759.432-20.08-.702-30.678l-1.186-11.085c-.453-4.24 2.616-8.046 6.856-8.499 4.242-.449 8.046 2.616 8.499 6.856l1.186 11.085c1.23 11.492 1.483 22.721.753 33.377-1.598 23.324-8.426 55.337-31.888 75.392-14.564 12.449-28.751 14.301-29.348 14.374-.316.039-.631.058-.943.058z" fill="#0bb494" id="path49311" style="opacity:1;fill:#f45b69;fill-opacity:1;stroke-width:258.859"/></g><path d="m99.22 32.25c54.02-16.304 94.124 31.976 82.031 97.634-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 7.207 128.69-146.88 153.812-189.774 79.616-38.092-65.889 25.07-126.332 25.07-126.332l15.768 13.085s-54.212 57.459-6.717 98.644c41.377 35.88 119.62 4.994 94.473-63.798-22.727-62.169-113.186-48.785-155.96-107.49C70.063 228.345 104.751 176.066 120.847 144.993c26.901-51.934 11.207-94.471-22.844-80.767z" fill="#c9f6b0" id="path49315" style="fill:#9d2a35;fill-opacity:1;stroke-width:258.859"/><g id="g49319" style="stroke-width:37.9613"><path d="M328.066 390.702C323.797 314.463 265.762 273.176 230.826 252.7c-36.02-21.111-61.517-57.973-49.575-122.816C193.344 64.227 153.24 15.946 99.22 32.25l-.016.427c31.181 11.593 49.582 49.885 40.867 97.207-11.942 64.843 13.555 101.705 49.575 122.816 34.936 20.476 92.97 61.763 97.24 138.002 3.97 70.889-41.004 110.348-89.374 119.094 59.897 11.218 135.657-27.974 130.554-119.094z" fill="#bbf49b" id="path49317" style="fill:#c73849;fill-opacity:.992157;stroke-width:258.859"/></g><path d="M86.13 29.061 146.528.0s-10.295 53.02-52.157 74.817L75.834 69.492z" fill="#6fd7a3" id="path49321" style="fill:#7f2d37;fill-opacity:1;stroke-width:258.859"/><path d="m108.988.0-14.942 49.333.325 25.484c.132 10.356-5.648 19.894-14.922 24.625l-53.66 27.374C13.17 133.254-.159 119.45 6.856 107.202c8.309-14.507 17.855-31.646 27.245-49.53C41.851 42.911 53.79 30.729 68.409 22.59z" fill="#c9f6b0" id="path49323" style="fill:#ee505f;fill-opacity:1;stroke-width:258.859"/><path d="m181.814 315.601c4.614-3.907 11.558.252 10.29 6.164l-6.293 29.354-7.207 33.619c-1.15 5.364-8.11 6.832-11.328 2.389L157.07 373.035c-1.033-1.427-2.614-2.359-4.362-2.573l-16.799-2.056c-5.486-.672-7.543-7.554-3.325-11.126l26.177-22.163z" fill="#6fd7a3" id="path49325" style="fill:#eb4f5d;fill-opacity:1;stroke-width:258.859"/><path d="m408.662 213.882c-2.855.0-5.599-1.59-6.939-4.325-.083-.168-8.514-17.05-27.948-36.153-17.846-17.542-48.949-40.642-95.775-51.077-4.162-.927-6.784-5.054-5.857-9.216.927-4.162 5.05-6.787 9.216-5.857 50.722 11.302 84.422 36.5 103.761 55.648 21.095 20.887 30.105 39.107 30.478 39.872 1.869 3.833.277 8.455-3.556 10.324-1.091.533-2.244.784-3.38.784z" fill="#0bb494" id="path49327" style="opacity:1;fill:#f45b69;fill-opacity:1;stroke-width:258.859"/><path d="m308.106 254.226c-.035.0-.068.0-.103-.001-4.254-.056-7.66-3.541-7.62-7.792.0-.459-.233-27.156-22.522-73.746-1.84-3.847-.214-8.457 3.633-10.298s8.457-.214 10.298 3.633c24.143 50.465 24.049 79.377 24.033 80.583-.056 4.231-3.502 7.621-7.719 7.621z" fill="#0bb494" id="path49329" style="opacity:1;fill:#f45b69;fill-opacity:1;stroke-width:258.859"/><g fill="#6fd7a3" id="g49339" style="display:inline;stroke-width:258.859"><path d="m293.41 353.127c-2.935.0-5.74-1.682-7.034-4.528-1.765-3.882-.048-8.459 3.834-10.224 6.955-3.161 18.792-10.715 18.911-10.791 3.592-2.297 8.368-1.248 10.665 2.345s1.248 8.367-2.345 10.665c-.522.334-12.881 8.222-20.84 11.839-1.036.47-2.122.694-3.191.694z" id="path49331" style="fill:#7f2430;fill-opacity:.992157;stroke-width:37.9613"/><path d="m308.098 407.232c-4.104.0-7.52-3.231-7.707-7.372-.193-4.26 3.104-7.87 7.364-8.063l20.207-.915c4.259-.189 7.87 3.104 8.063 7.364s-3.104 7.87-7.364 8.063l-20.207.915c-.119.005-.238.008-.356.008z" id="path49333" style="fill:#7f2430;fill-opacity:.992157;stroke-width:37.9613"/><path d="m310.641 470.991c-1.381.0-2.779-.37-4.042-1.148l-14.183-8.736c-3.631-2.236-4.762-6.993-2.525-10.623 2.236-3.632 6.993-4.762 10.623-2.525l14.184 8.736c3.631 2.236 4.762 6.993 2.525 10.623-1.459 2.368-3.99 3.673-6.582 3.673z" id="path49335" style="fill:#7f2430;fill-opacity:.992157;stroke-width:37.9613"/><path d="m258.788 512c-2.901.0-5.679-1.642-6.994-4.441l-7.245-15.427c-1.813-3.86-.153-8.458 3.707-10.271 3.858-1.813 8.458-.153 10.271 3.707l7.245 15.427c1.813 3.86.153 8.458-3.707 10.271-1.06.498-2.177.734-3.277.734z" id="path49337" style="fill:#7f2430;fill-opacity:.992157;stroke-width:37.9613"/></g></g></g></svg></a><div id=navbarNav class="offcanvas offcanvas-end bg-dark"><div class="offcanvas-header border-bottom border-light"><h5 class="offcanvas-title text-white">Menu</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a href=https://obfuscator.re//omvll class="nav-link text-gradient-omvll"><strong>O-MVLL</strong></a></li><li class=nav-item><a href=https://obfuscator.re//dprotect class="nav-link text-gradient-dprotect"><strong>dProtect</strong></a></li><li class=nav-item><a href=/challenges/ class=nav-link>Challenges</a></li><li class=nav-item><a href=/resources/ class=nav-link>Resources</a></li><li class=nav-item><a href=https://obfuscator.re/#faq class=nav-link>FAQ</a></li></ul></div></div><button type=button class="navbar-toggler d-block d-lg-none ms-auto me-4" data-bs-toggle=offcanvas data-bs-target=#navbarNav aria-controls=navbarNav aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button></div></header><section class="container pb-5 mb-md-2 mb-lg-4" style=padding-top:9rem!important><h2 id=writeup-for-obfuscatorre-challenge-1>Writeup for obfuscator.re Challenge 1</h2><p>The application has a simple login screen:</p><figure><img src=mLjwwEC.png width=400><figcaption><h4>Login screen</h4></figcaption></figure><p>Checking the source code in jadx:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ jadx-gui apks/challenge-pydroid.apk 2&gt;&amp;<span style=color:#bd93f9>1</span> &gt;/dev/null &amp;
</span></span></code></pre></div><br><p>We see that the code behind the check is inside a native function:</p><p><img src=TAWWBRX.png alt></p><br><p><img src=75cwupq.png alt></p><br><p><img src=./J4OsFvG.png alt></p><p>Installing the app and running frida:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb install apks/challenge-pydroid.apk
</span></span></code></pre></div><br><p>Searching for <code>system.load</code> in jadx we can find where the lib is being loaded:
<img src=OTuLQ4l.png alt></p><p>Let&rsquo;s write a script to decrypt the string and see what the name of the lib that is being loaded:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Java.perform(<span style=color:#8be9fd;font-style:italic>function</span>(){
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> Application <span style=color:#ff79c6>=</span> Java.use(<span style=color:#f1fa8c>&#34;re.obfuscator.challenge01.Application&#34;</span>);
</span></span><span style=display:flex><span>    console.log(Application[<span style=color:#f1fa8c>&#34;de&#34;</span>](<span style=color:#f1fa8c>&#34;\uf74d\uf71c\uf75c\uf74a\uf718\uf71a&#34;</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><br><p>Injecting the script on boot:</p><pre tabindex=0><code>$ frida -l decryptString.js -f re.obfuscator.challenge01 --no-pause
[Pixel 4 XL::re.obfuscator.challenge01 ]-&gt; a1re03
</code></pre><br><p>It seems like the library name is <code>a1re03</code>, since it&rsquo;s using the api call <code>system.loadLibrary</code> we should find a file with the prefix <strong>lib</strong> <code>liba1re03.so</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apktool d apks/challenge-pydroid.apk -o challenge-pydroid
</span></span><span style=display:flex><span>$ ls challenge-pydroid/lib/arm64-v8a
</span></span><span style=display:flex><span>liba1re03.so
</span></span></code></pre></div><br><p>Openning the library in ghidra we can see and check the entrypoints, and we can see the <code>.init_array</code> is not initialised:</p><figure><img src=mbERVBs.png width=400></figure><p>I tried to search for functions in the symbol-tree with the prefix <code>java_</code> but didn&rsquo;t find any, so I believe the linking between Java and the native code should be done with the <code>registerNatives</code> function somewhere in the <code>JNI_OnLoad</code> function:
<img src=heLL9lS.png alt></p><p>It seems like there will be an indirect call, so instead of diving into the code, I used jnitrace to trace the function <code>JNI->registerNatives</code> to locate in ghidra the respective code related to the native function in Java:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>       /* TID <span style=color:#bd93f9>22199</span> */
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms <span style=color:#ff79c6>[</span>+<span style=color:#ff79c6>]</span> JNIEnv-&gt;RegisterNatives
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |- JNIEnv*          : 0xb400007cb2c51df0
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |- jclass           : 0x95    <span style=color:#ff79c6>{</span> re/obfuscator/challenge01/VCyPLJeiyfu <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |- JNINativeMethod* : 0x7febbf85c0
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |:     0x7b66211428 - PGPyIMEWUxFr<span style=color:#ff79c6>(</span>Ljava/lang/String;<span style=color:#ff79c6>)</span>Z
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |- jint             : <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |<span style=color:#ff79c6>=</span> jint             : <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms --------------------------------Backtrace--------------------------------
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |-&gt;       0x7b661ab0ac: liba1re03.so!0x1720ac <span style=color:#ff79c6>(</span>liba1re03.so:0x7b66039000<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>239</span> ms |-&gt;       0x7b661ab0ac: liba1re03.so!0x1720ac <span style=color:#ff79c6>(</span>liba1re03.so:0x7b66039000<span style=color:#ff79c6>)</span>
</span></span></code></pre></div><br><p>We can see where register natives is being called at <code>0x1720ac</code>. To see the code in ghidra, we can just go to the address <code>0x1720ac + 0x100000</code>  (We need to add 100k because ghidra by default will load the lib at that address).</p><p>The logic we truly want to check on is the function <code>PGPyIMEWUxFr</code>, jnitrace will give us the base address of the lib and the address of the start of the function, so basically, to calculate its real offset in ghidra we could just do <code>0x7b66211428-0x7b66039000+0x100000 = 0x2d8428</code>.</p><p>A lot of functions are not decompiled in ghidra and didn&rsquo;t perform the backtrack references through the code, mostly because of some of the techniques used described <a href=https://www.romainthomas.fr/publication/22-pst-the-poor-mans-obfuscator/whitepaper.pdf>here</a>.</p><p>Due to this problem, I decided to dump the library from memory and <a href=https://github.com/F8LEFT/SoFixer/tree/master>fix</a> the elf and in some way solve some of the problems generated by <a href=https://www.romainthomas.fr/publication/22-pst-the-poor-mans-obfuscator/whitepaper.pdf>this</a>, also we know omvll is based of o-llvm and some versions uses globals for the strings, based on experience the fastest way to circuvent string encryption for global variables is to use a dump, this is also described in the <a href=https://obfuscator.re/omvll/passes/strings-encoding/>documentation</a>.</p><p>We could write our own frida script to dump from memory, but to save time. There are already some scripts that perform the dump and fix the elf for us. One example of such is this <a href=https://github.com/lasting-yang/frida_dump/blob/master/dump_so.py>frida_dump</a></p><p>Perhaps we will encounter a problem while trying to dump (the code will dump the specified lib in the frontmost application):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python dump_so.py liba1re03.so
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>frida.core.RPCException: Error: access violation accessing 0x7b6cdcf000
</span></span><span style=display:flex><span>    at &lt;anonymous&gt; <span style=color:#ff79c6>(</span>frida/runtime/core.js:138<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    at dumpmodule <span style=color:#ff79c6>(</span>/script1.js:12<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    at apply <span style=color:#ff79c6>(</span>native<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    at &lt;anonymous&gt; <span style=color:#ff79c6>(</span>frida/runtime/message-dispatcher.js:13<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    at c <span style=color:#ff79c6>(</span>frida/runtime/message-dispatcher.js:23<span style=color:#ff79c6>)</span>
</span></span></code></pre></div><br><p>Seems like there is a section of the lib that doesn&rsquo;t have read permissions, to solve this we must adapt the <code>dump_so.js</code> to change the memory region, also this line of code doesn&rsquo;t seem to fully work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>...
</span></span><span style=display:flex><span>Memory.protect(ptr(libso.base), libso.size, <span style=color:#f1fa8c>&#39;rwx&#39;</span>);
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><br><p>If we investigate the address mapping:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell <span style=color:#f1fa8c>&#34;ps | grep -i &#39;re.obfuscator.challenge01&#39;&#34;</span>
</span></span><span style=display:flex><span>u0_a282      <span style=color:#bd93f9>22584</span>  <span style=color:#bd93f9>9119</span> <span style=color:#bd93f9>15130452</span> <span style=color:#bd93f9>373024</span> SyS_epoll_wait     <span style=color:#bd93f9>0</span> S re.obfuscator.challenge01
</span></span><span style=display:flex><span>$ adb shell <span style=color:#f1fa8c>&#34;cat /proc/22584/maps | grep &#39;liba1re03.so&#39;&#34;</span>
</span></span><span style=display:flex><span>7b6b4d1000-7b6b910000 rwxp <span style=color:#bd93f9>00000000</span> fd:04 <span style=color:#bd93f9>143995</span> /data/app/~~wo0sC2WdNe1hirJvBsr8gQ<span style=color:#ff79c6>==</span>/re.obfuscator.challenge01-jU98uNg4F1DuhOs3utp2zA<span style=color:#ff79c6>==</span>/lib/arm64/liba1re03.so
</span></span><span style=display:flex><span>7b6b910000-7b6b919000 r--p 0043e000 fd:04 <span style=color:#bd93f9>143995</span> /data/app/~~wo0sC2WdNe1hirJvBsr8gQ<span style=color:#ff79c6>==</span>/re.obfuscator.challenge01-jU98uNg4F1DuhOs3utp2zA<span style=color:#ff79c6>==</span>/lib/arm64/liba1re03.so
</span></span><span style=display:flex><span>7b6b919000-7b6cdc7000 rw-p <span style=color:#bd93f9>00446000</span> fd:04 <span style=color:#bd93f9>143995</span> /data/app/~~wo0sC2WdNe1hirJvBsr8gQ<span style=color:#ff79c6>==</span>/re.obfuscator.challenge01-jU98uNg4F1DuhOs3utp2zA<span style=color:#ff79c6>==</span>/lib/arm64/liba1re03.so
</span></span><span style=display:flex><span>7b6edc6000-7b6eeef000 rwxp 018f5000 fd:04 <span style=color:#bd93f9>143995</span> /data/app/~~wo0sC2WdNe1hirJvBsr8gQ<span style=color:#ff79c6>==</span>/re.obfuscator.challenge01-jU98uNg4F1DuhOs3utp2zA<span style=color:#ff79c6>==</span>/lib/arm64/liba1re03.so
</span></span></code></pre></div><br><p>Maybe because changing the entire permissions of lib may cause some problems to solve this, we just adapt that special region of memory and do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Memory.protect(ptr(<span style=color:#bd93f9>0x7b6cdcf000</span>), libso.size<span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>0x7b6cdcf000</span><span style=color:#ff79c6>-</span>libso.base), <span style=color:#f1fa8c>&#39;rwx&#39;</span>);
</span></span></code></pre></div><br><p>Since we are attaching to the process, we don&rsquo;t need to update the address <code>0x7b6cdcf000</code> but if you are trying to do the same, you will need to update your address depending on the error.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python dump_so.py liba1re03.so                                                                                                <span style=color:#bd93f9>1</span> ⚙
</span></span><span style=display:flex><span><span style=color:#ff79c6>{</span><span style=color:#f1fa8c>&#39;name&#39;</span>: <span style=color:#f1fa8c>&#39;liba1re03.so&#39;</span>, <span style=color:#f1fa8c>&#39;base&#39;</span>: <span style=color:#f1fa8c>&#39;0x7b6b4d1000&#39;</span>, <span style=color:#f1fa8c>&#39;size&#39;</span>: 60940288, <span style=color:#f1fa8c>&#39;path&#39;</span>: <span style=color:#f1fa8c>&#39;/data/app/~~wo0sC2WdNe1hirJvBsr8gQ==/re.obfuscator.challenge01-jU98uNg4F1DuhOs3utp2zA==/lib/arm64/liba1re03.so&#39;</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>android/SoFixer64: <span style=color:#bd93f9>1</span> file pushed, <span style=color:#bd93f9>0</span> skipped. 22.3 MB/s <span style=color:#ff79c6>(</span><span style=color:#bd93f9>186656</span> bytes in 0.008s<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>liba1re03.so.dump.so: <span style=color:#bd93f9>1</span> file pushed, <span style=color:#bd93f9>0</span> skipped. 37.3 MB/s <span style=color:#ff79c6>(</span><span style=color:#bd93f9>60940288</span> bytes in 1.558s<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>adb shell /data/local/tmp/SoFixer -m 0x7b6b4d1000 -s /data/local/tmp/liba1re03.so.dump.so -o /data/local/tmp/liba1re03.so.dump.so.fix.so
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>main_loop:87<span style=color:#ff79c6>]</span>start to rebuild elf file
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>Load:69<span style=color:#ff79c6>]</span>dynamic segment have been found in loadable segment, argument baseso will be ignored.
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildPhdr:25<span style=color:#ff79c6>]=============</span><span style=color:#8be9fd;font-style:italic>LoadDynamicSectionFromBaseSource</span><span style=color:#ff79c6>==========</span><span style=color:#8be9fd;font-style:italic>RebuildPhdr</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildPhdr:37<span style=color:#ff79c6>]=====================</span>RebuildPhdr <span style=color:#8be9fd;font-style:italic>End</span><span style=color:#ff79c6>======================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:549<span style=color:#ff79c6>]=======================</span><span style=color:#8be9fd;font-style:italic>ReadSoInfo</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:696<span style=color:#ff79c6>]</span>soname
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6ffffffb arg 0x00000001
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x00000009 arg 0x00000018
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6ffffff9 arg 0x00002d60
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:591<span style=color:#ff79c6>]</span> plt_rel <span style=color:#ff79c6>(</span>DT_JMPREL<span style=color:#ff79c6>)</span> found at 498a8
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:595<span style=color:#ff79c6>]</span> plt_rel_count <span style=color:#ff79c6>(</span>DT_PLTRELSZ<span style=color:#ff79c6>)</span> <span style=color:#bd93f9>549</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:584<span style=color:#ff79c6>]</span>symbol table found at 38f5000
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:580<span style=color:#ff79c6>]</span>string table found at 393b7a0
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6ffffef5 arg 0x03a12219
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:629<span style=color:#ff79c6>]</span> constructors <span style=color:#ff79c6>(</span>DT_INIT_ARRAY<span style=color:#ff79c6>)</span> found at <span style=color:#bd93f9>445738</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:633<span style=color:#ff79c6>]</span> constructors <span style=color:#ff79c6>(</span>DT_INIT_ARRAYSZ<span style=color:#ff79c6>)</span> <span style=color:#bd93f9>13</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:637<span style=color:#ff79c6>]</span> destructors <span style=color:#ff79c6>(</span>DT_FINI_ARRAY<span style=color:#ff79c6>)</span> found at <span style=color:#bd93f9>445728</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:641<span style=color:#ff79c6>]</span> destructors <span style=color:#ff79c6>(</span>DT_FINI_ARRAYSZ<span style=color:#ff79c6>)</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6ffffff0 arg 0x03a0c421
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6ffffffe arg 0x00003c68
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:699<span style=color:#ff79c6>]</span>Unused DT entry: <span style=color:#8be9fd;font-style:italic>type</span> 0x6fffffff arg 0x00000003
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>ReadSoInfo:703<span style=color:#ff79c6>]=======================</span>ReadSoInfo <span style=color:#8be9fd;font-style:italic>End</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildShdr:42<span style=color:#ff79c6>]=======================</span><span style=color:#8be9fd;font-style:italic>RebuildShdr</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildShdr:536<span style=color:#ff79c6>]=====================</span>RebuildShdr <span style=color:#8be9fd;font-style:italic>End</span><span style=color:#ff79c6>======================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildRelocs:783<span style=color:#ff79c6>]=======================</span><span style=color:#8be9fd;font-style:italic>RebuildRelocs</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildRelocs:809<span style=color:#ff79c6>]=======================</span>RebuildRelocs <span style=color:#8be9fd;font-style:italic>End</span><span style=color:#ff79c6>=======================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildFin:709<span style=color:#ff79c6>]=======================</span>try to finish file <span style=color:#8be9fd;font-style:italic>rebuild</span> <span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>RebuildFin:733<span style=color:#ff79c6>]=======================</span><span style=color:#8be9fd;font-style:italic>End</span><span style=color:#ff79c6>=========================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>main:123<span style=color:#ff79c6>]</span>Done!!!
</span></span><span style=display:flex><span>/data/local/tmp/liba1re03.so.dump.so.fix.so: <span style=color:#bd93f9>1</span> file pulled, <span style=color:#bd93f9>0</span> skipped. 38.0 MB/s <span style=color:#ff79c6>(</span><span style=color:#bd93f9>60941163</span> bytes in 1.528s<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>liba1re03.so_0x7b6b4d1000_60940288_fix.so
</span></span></code></pre></div><br><p>Now if we view .init_array section we can see a bunch of pointers to functions that will initialize globals and important stuff for the lib:
<img src=cOy1Wdi.png alt></p><p><code>_INIT_4</code> seems to have some python code related to the flag:
<img src=h75E4zr.png alt></p><p>Extracting the code from the string we get:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> android
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> android <span style=color:#ff79c6>import</span> decode, <span style=color:#8be9fd;font-style:italic>hash</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> json
</span></span><span style=display:flex><span>data <span style=color:#ff79c6>=</span> json<span style=color:#ff79c6>.</span>loads(json_data)
</span></span><span style=display:flex><span>login, password <span style=color:#ff79c6>=</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>login    <span style=color:#ff79c6>=</span> decode(login)
</span></span><span style=display:flex><span>password <span style=color:#ff79c6>=</span> decode(password)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> login <span style=color:#ff79c6>+</span> password
</span></span><span style=display:flex><span>h <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>hash</span>(flag)<span style=color:#ff79c6>.</span>hex()
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> h <span style=color:#ff79c6>!=</span> android<span style=color:#ff79c6>.</span>__FLAG__:
</span></span><span style=display:flex><span>  android<span style=color:#ff79c6>.</span>print(<span style=color:#f1fa8c>&#34;Humm it looks like, it&#39;s not the good flag ...&#34;</span>)
</span></span><span style=display:flex><span>  android<span style=color:#ff79c6>.</span>print(<span style=color:#f1fa8c>&#34;It should be </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c> while it is </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(android<span style=color:#ff79c6>.</span>__FLAG__, h))
</span></span><span style=display:flex><span><span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>  android<span style=color:#ff79c6>.</span>print(<span style=color:#f1fa8c>&#34;Well done!&#34;</span>)
</span></span><span style=display:flex><span>  is_valid <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
</span></span></code></pre></div><br><p>It seems flag check is being done here, and the flag is the combination of login and password, looks like the function <code>hash</code> is from a custom module named <code>android</code>, for now we still don&rsquo;t know what is the value of android.__FLAG__ and what the function <code>hash</code> does, but if look into <code>adb logcat</code> we can actually see the function <code>print</code> is just some logging function which will appear in the logcat:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>adb shell logcat | grep <span style=color:#f1fa8c>&#39;omvll&#39;</span>
</span></span><span style=display:flex><span>07-23 00:34:09.465 <span style=color:#bd93f9>23655</span> <span style=color:#bd93f9>23655</span> I omvll   : Humm it looks like, it&#39;s not the good flag ...
</span></span><span style=display:flex><span>07-23 00:34:09.465 <span style=color:#bd93f9>23655</span> <span style=color:#bd93f9>23655</span> I omvll   : It should be f5ca458deb9629a74d4b0c3669deb5078a6a85a90afba9a3c76f5306a4bafb06 <span style=color:#ff79c6>while</span> it is e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
</span></span></code></pre></div><br><p>It looks like the concatenation of the login and password should be <code>e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code> after applying the hash function, from the size of the hash it looks like this is some kind of sha256 but we need confirmation.</p><p>We could try to look in the native lib where the module is being initiated or loaded, but since we know that the global variable is located at <code>0x548778 - 0x100000</code> we can just write a frida script and inject our own python code to inspect this module!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import android
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from android import decode, hash
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.print(hash.__doc__)`</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> python_addr <span style=color:#ff79c6>=</span> moduleBaseAddress.add(<span style=color:#bd93f9>0x548778</span><span style=color:#ff79c6>-</span>ghidra_base);
</span></span><span style=display:flex><span>python_addr.writeUtf8String(inject_python);
</span></span></code></pre></div><br><p>The output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>echo</span> -n <span style=color:#f1fa8c>&#39;abc&#39;</span> | sha256sum
</span></span><span style=display:flex><span>ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad
</span></span><span style=display:flex><span>$ frida -Ul inj_k.js -F --no-pause
</span></span><span style=display:flex><span>$ adb shell logcat | grep <span style=color:#f1fa8c>&#39;omvll&#39;</span> <span style=color:#6272a4># login in the app to trigger the print</span>
</span></span><span style=display:flex><span>07-23 01:54:37.928 <span style=color:#bd93f9>24105</span> <span style=color:#bd93f9>24105</span> I omvll   : ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad
</span></span></code></pre></div><br><p>This confirms that we indeed are dealing with sha256 hash. When I got this confirmation, I said to myself that there is no way this challenge is to bruteforce the login and password with a dictionary attack or something. I started to believe that maybe the dev left something within the custom <code>android</code> module that is not being used in the main script that could give us some tips about how the hash got generated or something:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import android
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from android import decode, hash
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.print(str(dir(android)))`</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> python_addr <span style=color:#ff79c6>=</span> moduleBaseAddress.add(<span style=color:#bd93f9>0x548778</span><span style=color:#ff79c6>-</span>ghidra_base);
</span></span><span style=display:flex><span>python_addr.writeUtf8String(inject_python);
</span></span></code></pre></div><br><p>And we saw 3 interesting fields <code>MvtKNJXCOGJe</code>, <code>__bc__</code> and <code>__doc__</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>07-23 15:28:56.809 <span style=color:#bd93f9>27698</span> <span style=color:#bd93f9>27698</span> I omvll   : <span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;MvtKNJXCOGJe&#39;</span>, <span style=color:#f1fa8c>&#39;__FLAG__&#39;</span>, <span style=color:#f1fa8c>&#39;__bc__&#39;</span>, <span style=color:#f1fa8c>&#39;__doc__&#39;</span>, <span style=color:#f1fa8c>&#39;__loader__&#39;</span>, <span style=color:#f1fa8c>&#39;__name__&#39;</span>, <span style=color:#f1fa8c>&#39;__package__&#39;</span>, <span style=color:#f1fa8c>&#39;__spec__&#39;</span>, <span style=color:#f1fa8c>&#39;decode&#39;</span>, <span style=color:#f1fa8c>&#39;hash&#39;</span>, <span style=color:#f1fa8c>&#39;print&#39;</span><span style=color:#ff79c6>]</span>
</span></span></code></pre></div><br><p><code>MvtKNJXCOGJe</code> is a function that receives a string and returns bytes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>android.print(str(android.MvtKNJXCOGJe.__doc__));
</span></span></code></pre></div><br><p>The documentation of the function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>I omvll   : MvtKNJXCOGJe<span style=color:#ff79c6>(</span>arg0: str<span style=color:#ff79c6>)</span> -&gt; bytes
</span></span></code></pre></div><br><p><code>__bc__</code> seems to be a sequence of python bytecode which, after removing the new lines and decode hex data we get something very similar to a pyc file ? (header seems to be different and decompilers won&rsquo;t work)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>android.print(str(android.__bc__));
</span></span></code></pre></div><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>7-23 21:24:54.840 <span style=color:#bd93f9>29800</span> <span style=color:#bd93f9>29800</span> I omvll   :     700d0d0a000000004aaf626335010000e300000000000000000000000000000000040000004
</span></span><span style=display:flex><span>07-23 21:24:54.840 <span style=color:#bd93f9>29800</span> <span style=color:#bd93f9>29800</span> I omvll   :     00000007338000000640064016d005a00640064016d015a0164026502640365036604640464
</span></span><span style=display:flex><span>07-23 21:24:54.840 <span style=color:#bd93f9>29800</span> <span style=color:#bd93f9>29800</span> I omvll   :     0583045a04640265026403650366046406640783045a05640153002908e9000000004eda046
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><br><p><code>__doc__</code> This contains some hash similar to the sha256 but we don&rsquo;t know yet for what it used.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>android.print(str(android.__doc__));
</span></span></code></pre></div><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>07-23 21:25:44.407 <span style=color:#bd93f9>29800</span> <span style=color:#bd93f9>29800</span> I omvll   : 9c16a9c3017d2b3876323bc4f9dad2b7530c
</span></span></code></pre></div><br><p>My next step was to see what code is behind <code>MvtKNJXCOGJe</code> we tried using the built-in module <code>dis</code> to get the disassemble code but it seems the function returns an error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Abort message: <span style=color:#f1fa8c>&#39;terminating with uncaught exception of type pybind11::error_already_set: TypeError: don&#39;</span>t know how to disassemble builtin_function_or_method objects
</span></span></code></pre></div><br><p>This means that this module is being loaded in the native code using cpython or pybind11.</p><p>To understand a little better I did some research on google and I learned that you could create a python module using cpython like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;Python.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> __flag__ <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;f0d15e5bb173d9a281cfaf2a2b01779a7e78c2b24a48f2cc74563b235c4c5b9b&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Module method table
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>static</span> PyMethodDef AndroidMethods[] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    {<span style=color:#8be9fd;font-style:italic>NULL</span>, <span style=color:#8be9fd;font-style:italic>NULL</span>, <span style=color:#bd93f9>0</span>, <span style=color:#8be9fd;font-style:italic>NULL</span>}
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Module definition
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>static</span> <span style=color:#ff79c6>struct</span> PyModuleDef androidmodule <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    PyModuleDef_HEAD_INIT,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;android&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span>    AndroidMethods
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Module initialization function
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>PyMODINIT_FUNC <span style=color:#50fa7b>PyInit_android</span>(<span style=color:#8be9fd>void</span>) {
</span></span><span style=display:flex><span>    PyObject<span style=color:#ff79c6>*</span> module <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>PyModule_Create</span>(<span style=color:#ff79c6>&amp;</span>androidmodule);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Add the __flag__ variable to the module
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    PyObject<span style=color:#ff79c6>*</span> flag <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>Py_BuildValue</span>(<span style=color:#f1fa8c>&#34;s&#34;</span>, __flag__);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (flag) {
</span></span><span style=display:flex><span>        <span style=color:#50fa7b>PyModule_AddObject</span>(module, <span style=color:#f1fa8c>&#34;__flag__&#34;</span>, flag);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> module;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><br><p>In a main program we could do something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;Python.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Declare the init function for the &#34;android&#34; module
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>extern</span> PyObject<span style=color:#ff79c6>*</span> <span style=color:#50fa7b>PyInit_android</span>(<span style=color:#8be9fd>void</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> argv[]) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Initialize the Python interpreter
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>Py_Initialize</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Add the &#34;android&#34; module to the pyinittab
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>PyImport_AppendInittab</span>(<span style=color:#f1fa8c>&#34;android&#34;</span>, <span style=color:#ff79c6>&amp;</span>PyInit_android);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Start the interpreter
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>Py_Main</span>(argc, argv);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Finalize the Python interpreter
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#50fa7b>Py_Finalize</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><br><p>After running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./interpreter
</span></span><span style=display:flex><span>Python 3.6.9 <span style=color:#ff79c6>(</span>default, Jul <span style=color:#bd93f9>23</span> 2023, 00:00:00<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>GCC 8.4.0<span style=color:#ff79c6>]</span> on linux
</span></span><span style=display:flex><span>Type <span style=color:#f1fa8c>&#34;help&#34;</span>, <span style=color:#f1fa8c>&#34;copyright&#34;</span>, <span style=color:#f1fa8c>&#34;credits&#34;</span> or <span style=color:#f1fa8c>&#34;license&#34;</span> <span style=color:#ff79c6>for</span> more information.
</span></span><span style=display:flex><span>&gt;&gt;&gt; import android
</span></span><span style=display:flex><span>&gt;&gt;&gt; print<span style=color:#ff79c6>(</span>android.__flag__<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;f0d15e5bb173d9a281cfaf2a2b01779a7e78c2b24a48f2cc74563b235c4c5b9b&#39;</span>
</span></span></code></pre></div><br><p>A good strategy here is to actually find where the string &ldquo;android&rdquo; is being called in the android code:
<img src=XACkJPw.png alt></p><p>This already looks promissing:
<img src=NL09XQm.png alt></p><p>Diving in FUN_00280c08 we can see that there is a function that looks like is adding somekind of variable <code>__flag__</code> to the module:
<img src=9TC8hwC.png alt></p><p>Searching for xrefs to those functions lead me to more assignments of <code>__bc__</code> and <code>__doc__</code>:
<img src=hJuODw2.png alt></p><p>But the most important one was the function <code>FUN_002c22b0</code> contains the print string, which probably means that this function might be responsible for function attribution,
searching for xrefs didn&rsquo;t find anything which means this is probably some kind of proxy call, so we might need to check some of the internal calls:
<img src=Mn9uZMO.png alt></p><p>Searching for <code>MvtKNJXCOGJe</code> I didn&rsquo;t find anything, so this means that the author might have used <code>StringEncOptStack</code> instead of <code>StringEncOptGlobal</code> to hide this string, so I assumed that these internal functions are related to function attributions to the python module, probably related to pybind11 so I decided to hook <code>FUN_002ce5cc</code> we know that the second parameter is the name of the function and the 3rd is most likely the pointer to the function definition so we can write a frida script to hook this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> do_dlopen <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> call_ctor <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> hooked <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Process.findModuleByName(Process.pointerSize <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>4</span> <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#39;linker&#39;</span> <span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;linker64&#39;</span>).enumerateSymbols().forEach(<span style=color:#8be9fd;font-style:italic>function</span> (sym) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (sym.name.indexOf(<span style=color:#f1fa8c>&#39;do_dlopen&#39;</span>) <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    do_dlopen <span style=color:#ff79c6>=</span> sym.address;
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (sym.name.indexOf(<span style=color:#f1fa8c>&#39;call_constructor&#39;</span>) <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    call_ctor <span style=color:#ff79c6>=</span> sym.address;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>Interceptor.attach(do_dlopen,{
</span></span><span style=display:flex><span>  onEnter<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(args){
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>var</span> soName <span style=color:#ff79c6>=</span> args[<span style=color:#bd93f9>0</span>].readCString();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>var</span> temp <span style=color:#ff79c6>=</span> soName.split(<span style=color:#f1fa8c>&#34;/&#34;</span>).pop();
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.libname <span style=color:#ff79c6>=</span> temp;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (temp.indexOf(libname) <span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>      Interceptor.attach(call_ctor, <span style=color:#8be9fd;font-style:italic>function</span> () {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span>(hooked <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>false</span>) {
</span></span><span style=display:flex><span>          moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(temp);
</span></span><span style=display:flex><span>          hooked <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>true</span>;
</span></span><span style=display:flex><span>          before_init_initarray(temp);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  onLeave<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(retval){
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span>.libname.includes(libname)) {
</span></span><span style=display:flex><span>      after_init_initarray(<span style=color:#ff79c6>this</span>.libname);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> before_init_initarray(libname){
</span></span><span style=display:flex><span>  Interceptor.attach(moduleBaseAddress.add(<span style=color:#bd93f9>0x2ce5cc</span><span style=color:#ff79c6>-</span>ghidra_base),{
</span></span><span style=display:flex><span>    onEnter<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(args){
</span></span><span style=display:flex><span>      console.log(args[<span style=color:#bd93f9>1</span>].readCString() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34; &#34;</span> <span style=color:#ff79c6>+</span> args[<span style=color:#bd93f9>2</span>]);
</span></span><span style=display:flex><span>      console.log(<span style=color:#f1fa8c>&#39;called from:\n&#39;</span> <span style=color:#ff79c6>+</span>
</span></span><span style=display:flex><span>        Thread.backtrace(<span style=color:#ff79c6>this</span>.context, Backtracer.ACCURATE)
</span></span><span style=display:flex><span>        .map(DebugSymbol.fromAddress).join(<span style=color:#f1fa8c>&#39;\n&#39;</span>) <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;\n&#39;</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    onLeave<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(retval){
</span></span><span style=display:flex><span>    }});
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> after_init_initarray(libname){}
</span></span></code></pre></div><br><p>The code above is not entirely necessary. I added this in case you want to hook something before some function in .init_array executes. This involves hooking some android linker functions and stuff, but it&rsquo;s not necessary if you really want, you could just attach to the app and only contain the code inside of before_init_initarray function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ frida -Ul inj_k2.js -f re.obfuscator.challenge01 --no-pause
</span></span><span style=display:flex><span><span style=color:#6272a4># prints will only trigger after performing the login in the app</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>Pixel <span style=color:#bd93f9>4</span> XL::re.obfuscator.challenge01 <span style=color:#ff79c6>]</span>-&gt;
</span></span><span style=display:flex><span>print
</span></span><span style=display:flex><span>called from:
</span></span><span style=display:flex><span>0x7b6449033c liba1re03.so!0x1c233c
</span></span><span style=display:flex><span>0x7b6449033c liba1re03.so!0x1c233c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MvtKNJXCOGJe
</span></span><span style=display:flex><span>called from:
</span></span><span style=display:flex><span>0x7b644904c4 liba1re03.so!0x1c24c4
</span></span><span style=display:flex><span>0x7b644904c4 liba1re03.so!0x1c24c4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decode
</span></span><span style=display:flex><span>called from:
</span></span><span style=display:flex><span>0x7b644911f8 liba1re03.so!0x1c31f8
</span></span><span style=display:flex><span>0x7b644911f8 liba1re03.so!0x1c31f8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>hash</span>
</span></span><span style=display:flex><span>called from:
</span></span><span style=display:flex><span>0x7b644907bc liba1re03.so!0x1c27bc
</span></span><span style=display:flex><span>0x7b644907bc liba1re03.so!0x1c27bc
</span></span></code></pre></div><br><p>Looking at the address call <code>0x1c24c4 + 0x100000</code> in ghidra:
<img src=yfixa2e.png alt></p><p>If we instruct ghidra to disassemble the code:
<img src=CubaVw7.png alt></p><p>Let&rsquo;s hook that line and trigger the call by injecting python:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// on blr x8 to get the function pointer to the indirect call
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Interceptor.attach(moduleBaseAddress.add(<span style=color:#bd93f9>0x2c3488</span><span style=color:#ff79c6>-</span>ghidra_base),{
</span></span><span style=display:flex><span>  onEnter<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(args){
</span></span><span style=display:flex><span>    console.log(<span style=color:#ff79c6>this</span>.context.x8.sub(moduleBaseAddress).add(ghidra_base));
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  onLeave<span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>function</span>(retval){
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import android
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.MvtKNJXCOGJe(&#39;abc&#39;)`</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> python_addr <span style=color:#ff79c6>=</span> moduleBaseAddress.add(<span style=color:#bd93f9>0x548778</span><span style=color:#ff79c6>-</span>ghidra_base);
</span></span><span style=display:flex><span>python_addr.writeUtf8String(inject_python);
</span></span></code></pre></div><br><p>We get the address:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ frida -Ul inj_k2.js -F --no-pause
</span></span><span style=display:flex><span><span style=color:#6272a4># print will trigger only after trying to login</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>Pixel <span style=color:#bd93f9>4</span> XL::Open-Obfuscator Challenge <span style=color:#ff79c6>]</span>-&gt; 0x2c0ea8
</span></span></code></pre></div><br><p>After disassembling the function, we get a huge function:
<img src=k1sIgng.png alt></p><p>I didn&rsquo;t want to dive in into this function before understanding the context of this, I could end up reversing an entire function for nothing. So, after analysing the application with more attention, we noticed some files that were dropped into the cache folder <code>/data/data/re.obfuscator.challenge01/cache</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell <span style=color:#f1fa8c>&#34;ls /data/data/re.obfuscator.challenge01/cache/WebView/Default/Web3&#34;</span>                                                <span style=color:#bd93f9>1</span> ⚙
</span></span><span style=display:flex><span>LICENSE.txt
</span></span><span style=display:flex><span>__future__.py
</span></span><span style=display:flex><span>__phello__.foo.py
</span></span><span style=display:flex><span>__pycache__
</span></span><span style=display:flex><span>_aix_support.py
</span></span><span style=display:flex><span>_bootsubprocess.py
</span></span><span style=display:flex><span>_collections_abc.py
</span></span><span style=display:flex><span>_compat_pickle.py
</span></span><span style=display:flex><span>_compression.py
</span></span><span style=display:flex><span>_markupbase.py
</span></span><span style=display:flex><span>_osx_support.py
</span></span><span style=display:flex><span>_py_abc.py
</span></span><span style=display:flex><span>_pydecimal.py
</span></span><span style=display:flex><span>_pyio.py
</span></span><span style=display:flex><span>_sitebuiltins.py
</span></span><span style=display:flex><span>_strptime.py
</span></span><span style=display:flex><span>_sysconfigdata__linux_aarch64-linux-android.py
</span></span><span style=display:flex><span>_threading_local.py
</span></span><span style=display:flex><span>_weakrefset.py
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><br><p>By reading the license file, we realized this seems to be the source code of python. Some of the files here are python built-ins. After finding this, we pulled the folder:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb pull /data/data/re.obfuscator.challenge01/cache/WebView
</span></span></code></pre></div><br><p>By searching for one of the strange variables we found in android module with recursive grep, we found it was referenced in one of the files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ grep -ria <span style=color:#f1fa8c>&#39;__bc__&#39;</span> WebView
</span></span><span style=display:flex><span>WebView/Default/Web3/pyloader.py:        <span style=color:#ff79c6>return</span> bytes.fromhex<span style=color:#ff79c6>(</span>android.__bc__.replace<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;\n&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>)</span>.strip<span style=color:#ff79c6>()</span>.replace<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34; &#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>))</span>
</span></span></code></pre></div><br><p>The python file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> importlib
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> importlib.machinery <span style=color:#ff79c6>import</span> SourcelessFileLoader
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> importlib.util <span style=color:#ff79c6>import</span> spec_from_file_location
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> sys
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> android
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>FileLoader</span>(SourcelessFileLoader):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __init__(self):
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>super</span>()<span style=color:#ff79c6>.</span>__init__(<span style=color:#f1fa8c>&#34;checker&#34;</span>, <span style=color:#f1fa8c>&#34;checker.cpython-310.pyc&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_data</span>(self, path: <span style=color:#8be9fd;font-style:italic>str</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>bytes</span><span style=color:#ff79c6>.</span>fromhex(android<span style=color:#ff79c6>.</span>__bc__<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>)<span style=color:#ff79c6>.</span>strip()<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#34; &#34;</span>, <span style=color:#f1fa8c>&#34;&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>import_checker</span>():
</span></span><span style=display:flex><span>    loader <span style=color:#ff79c6>=</span> FileLoader()
</span></span><span style=display:flex><span>    spec <span style=color:#ff79c6>=</span> spec_from_file_location(<span style=color:#f1fa8c>&#39;checker&#39;</span>, <span style=color:#f1fa8c>&#34;checker.cpython-310.pyc&#34;</span>,loader<span style=color:#ff79c6>=</span>loader)
</span></span><span style=display:flex><span>    module <span style=color:#ff79c6>=</span> importlib<span style=color:#ff79c6>.</span>_bootstrap<span style=color:#ff79c6>.</span>_load(spec)
</span></span><span style=display:flex><span>    sys<span style=color:#ff79c6>.</span>modules[<span style=color:#f1fa8c>&#39;checker&#39;</span>] <span style=color:#ff79c6>=</span> module
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> module
</span></span></code></pre></div><br><p>Looks like the <code>__bc__</code> is a hidden module, like I said before we tried before to decompile this specific variable, but it looks like Romain Thomas did change the python source code, making it harder for us to recover the original code. Running this code on our machine also wouldn&rsquo;t work because of these modifications. The bytecode would throw errors, then I had the idea of actually injecting this code into the interpreter in the application like we did before for other purposes, then we could list all objects in the module and maybe use the builtin <code>dis</code> on the functions to view a better representation of the bytecode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import importlib
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.machinery import SourcelessFileLoader
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.util import spec_from_file_location
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import sys
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import android,dis,string
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>class FileLoader(SourcelessFileLoader):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    def __init__(self):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        super().__init__(&#34;checker&#34;, &#34;checker.cpython-310.pyc&#34;)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    def get_data(self, path: str):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        import android
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        return bytes.fromhex(android.__bc__.replace(&#34;\\n&#34;, &#34;&#34;).strip().replace(&#34; &#34;, &#34;&#34;))
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>loader = FileLoader()
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec = spec_from_file_location(&#39;checker&#39;, &#34;checker.cpython-310.pyc&#34;,loader=loader)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>module = importlib._bootstrap._load(spec)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.print(str(dir(module)))
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>const python_addr = moduleBaseAddress.add(0x548778-ghidra_base);
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>python_addr.writeUtf8String(inject_python);
</span></span></span></code></pre></div><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb logcat | grep <span style=color:#f1fa8c>&#39;omvll&#39;</span>
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : <span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;__builtins__&#39;</span>, <span style=color:#f1fa8c>&#39;__cached__&#39;</span>, <span style=color:#f1fa8c>&#39;__doc__&#39;</span>, <span style=color:#f1fa8c>&#39;__file__&#39;</span>, <span style=color:#f1fa8c>&#39;__loader__&#39;</span>, <span style=color:#f1fa8c>&#39;__name__&#39;</span>, <span style=color:#f1fa8c>&#39;__package__&#39;</span>, <span style=color:#f1fa8c>&#39;__spec__&#39;</span>, <span style=color:#f1fa8c>&#39;android&#39;</span>, <span style=color:#f1fa8c>&#39;check&#39;</span>, <span style=color:#f1fa8c>&#39;json&#39;</span>, <span style=color:#f1fa8c>&#39;verify&#39;</span><span style=color:#ff79c6>]</span>
</span></span></code></pre></div><br><p>I found this interesting function named <code>check</code>, so let&rsquo;s use <code>dis</code> to disassemble the function and view the code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import importlib
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.machinery import SourcelessFileLoader
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.util import spec_from_file_location
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import sys
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import android,dis,string
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>class FileLoader(SourcelessFileLoader):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    def __init__(self):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        super().__init__(&#34;checker&#34;, &#34;checker.cpython-310.pyc&#34;)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    def get_data(self, path: str):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        import android
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        return bytes.fromhex(android.__bc__.replace(&#34;\\n&#34;, &#34;&#34;).strip().replace(&#34; &#34;, &#34;&#34;))
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>loader = FileLoader()
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec = spec_from_file_location(&#39;checker&#39;, &#34;checker.cpython-310.pyc&#34;,loader=loader)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>module = importlib._bootstrap._load(spec)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>def get_instruction_repr(instruction):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    import dis
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    opcode, arg, lineno = instruction.opname,instruction.argval, instruction.starts_line
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    if instruction.arg is not None:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        arg_str = f&#34; {arg}&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        return f&#34;{lineno}: {opcode}{arg_str}&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    else:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        return f&#34;{lineno}: {opcode}&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>bytecode = dis.Bytecode(module.check)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>for instruction in bytecode:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    android.print(get_instruction_repr(instruction))
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.print(&#34;android.__doc__ -&gt; &#34;+android.__doc__)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> python_addr <span style=color:#ff79c6>=</span> moduleBaseAddress.add(<span style=color:#bd93f9>0x548778</span><span style=color:#ff79c6>-</span>ghidra_base);
</span></span><span style=display:flex><span>python_addr.writeUtf8String(inject_python);
</span></span></code></pre></div><br><p>The code is very simple to understand and we can see a very similar code to the code we saw in the global string comparison with the sha256 hash:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 5: LOAD_GLOBAL json
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC loads
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST data
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: UNPACK_SEQUENCE <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST login
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST password
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 6: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC decode
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST login
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:35:30.516 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST login
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 7: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC decode
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST password
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST password
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 8: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC __obfuscated__
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST login
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST password
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: BINARY_ADD
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC hex
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_ATTR __doc__
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: <span style=color:#8be9fd;font-style:italic>COMPARE_OP</span> <span style=color:#ff79c6>==</span>
</span></span><span style=display:flex><span>07-24 01:35:30.517 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: RETURN_VALUE
</span></span><span style=display:flex><span>07-24 01:38:36.452 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 5: LOAD_GLOBAL json
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC loads
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST data
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: UNPACK_SEQUENCE <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST login
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST password
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 6: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC decode
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST login
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST login
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 7: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC decode
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST password
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: STORE_FAST password
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 8: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC __obfuscated__
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST login
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_FAST password
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: BINARY_ADD
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>07-24 01:38:36.453 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_METHOD_ENC hex
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: CALL_METHOD <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_GLOBAL android
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: LOAD_ATTR __doc__
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: <span style=color:#8be9fd;font-style:italic>COMPARE_OP</span> <span style=color:#ff79c6>==</span>
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : None: RETURN_VALUE
</span></span><span style=display:flex><span>07-24 01:38:36.454 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : android.__doc__ -&gt; 9c16a9c3017d2b3876323bc4f9dad2b7530c
</span></span></code></pre></div><br><p>The most important part is the fact the function is using a function <code>__obfuscated__</code> which we believe to be the same as <code>MvtKNJXCOGJe</code> and, instead of comparing the input with <code>android.__flag__</code> it will compare with <code>android.__doc__</code> which was the hash we didn&rsquo;t know what was its purpose.</p><p>Again, before going deep into the native code of <code>MvtKNJXCOGJe</code> I did some tests with a few inputs and I realized that the function was a simple encryption function that was encrypting the input byte by byte. Knowing this, I knew we could just bruteforce and get the password:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> libname <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;liba1re03.so&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> moduleBaseAddress <span style=color:#ff79c6>=</span> Module.findBaseAddress(libname);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> ghidra_base <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x100000</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> inject_python <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>`import importlib
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.machinery import SourcelessFileLoader
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>from importlib.util import spec_from_file_location
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import sys
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>import android,string
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>res = bytes.fromhex(android.__doc__)
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>i = 0x0
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>flag = &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>while i&lt; len(res):
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    for c in string.printable:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        _enc = android.MvtKNJXCOGJe(flag+c)[i]
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        if _enc == res[i]:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            flag += c
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            break
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    i +=1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>android.print(flag)`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> python_addr <span style=color:#ff79c6>=</span> moduleBaseAddress.add(<span style=color:#bd93f9>0x548778</span><span style=color:#ff79c6>-</span>ghidra_base);
</span></span><span style=display:flex><span>python_addr.writeUtf8String(inject_python);
</span></span></code></pre></div><br><p>After running we got the password:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>07-24 01:45:27.152 <span style=color:#bd93f9>31523</span> <span style=color:#bd93f9>31523</span> I omvll   : 0MvLL_And_dPr0t3ct
</span></span></code></pre></div><br></section></main><footer class="footer dark-mode bg-dark pt-5 pb-4 pb-lg-5"><div class="container text-center pt-lg-3"><p class="nav d-block fs-sm text-center pt-5 mt-lg-4 mb-0"><span class="text-light opacity-50">Site generated with</span>
<a class="nav-link d-inline-block p-0" href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>
<span class="text-light opacity-50">and created by</span>
<a class="nav-link d-inline-block p-0" href=https://www.romainthomas.fr/ target=_blank rel=noopener>R. Thomas</a></p></div></footer><noscript><div class="navbar navbar-expand-lg navbar-dark shadow-sm fixed-bottom d-flex justify-content-center align-items-center"><div class="alert alert-warning fade show" role=alert><i class="fa-solid fa-gingerbread-man me-2"></i>
This website is free from cookies, trackers, and ads but you might want to enable javascript for a
better UI experience.</div></div></noscript><script src=/vendor/bootstrap/dist/js/bootstrap.bundle.min.js></script>
<script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script>
<script src=/vendor/parallax-js/dist/parallax.min.js></script>
<script src=/vendor/jarallax/dist/jarallax.min.js></script>
<script src=/vendor/rellax/rellax.min.js></script>
<script src=/vendor/swiper/swiper-bundle.min.js></script>
<script src=/vendor/lightgallery/lightgallery.min.js></script>
<script src=/vendor/lightgallery/plugins/video/lg-video.min.js></script>
<script>jarallax(document.querySelectorAll(".jarallax"),{speed:.2})</script><script src=/js/theme.min.js></script>
<script src=/js/anime.min.js></script></body></html>